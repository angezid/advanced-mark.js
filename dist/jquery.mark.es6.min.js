/*!***************************************************
* advanced-mark.js v2.6.0
* https://github.com/angezid/advanced-mark.js
* MIT licensed
* Copyright (c) 2022–2025, angezid
* Based on 'mark.js', license https://git.io/vwTVl
*****************************************************/
class t{constructor(t,e){this.ctx=t,this.opt=e,this.map=new Map}static matches(t,e){if(!e||!e.length)return!1;const s="string"==typeof e?[e]:e,r=t.matches;return r&&s.some((e=>r.call(t,e)))}getContexts(){let t=this.ctx,e=this.opt.window,s=!1;if(!t)return[];Array.isArray(t)?s=!0:"string"==typeof t?t=e.document.querySelectorAll(t):void 0===t.length&&(t=[t]);const r=[];for(let e=0;e<t.length;e++)r.includes(t[e])||r.some((s=>s.contains(t[e])))||r.push(t[e]);return s&&r.sort(((t,s)=>(t.compareDocumentPosition(s)&e.Node.DOCUMENT_POSITION_FOLLOWING)>0?-1:1)),r}getIframeContents(t,e,s){try{t.contentWindow.document&&(this.map.set(t,"ready"),e())}catch(t){s(t)}}observeIframeLoad(t,e,s){if(this.map.has(t))return;let r=null;const o=()=>{clearTimeout(r),t.removeEventListener("load",o),this.getIframeContents(t,e,s)};t.addEventListener("load",o),this.map.set(t,!0),r=setTimeout(o,this.opt.iframesTimeout)}onIframeReady(t,e,s){const r="about:blank",o=t.getAttribute("src"),n=t.contentWindow;try{"complete"!==n.readyState||o&&o.trim()!==r&&n.location.href===r?this.observeIframeLoad(t,e,s):this.getIframeContents(t,e,s)}catch(t){s(t)}}waitForIframes(t,e){const s=this.opt.shadowDOM;let r,o=[];const n=t=>{const e=this.createIterator(t,this.opt.window.NodeFilter.SHOW_ELEMENT);for(;r=e.nextNode();){if(this.isIframe(r)){const t=new Promise((t=>{this.onIframeReady(r,(()=>{t()}),(e=>{t(),this.opt.debug&&console.log(e)}))}));o.push(t)}s&&r.shadowRoot&&"open"===r.shadowRoot.mode&&n(r.shadowRoot)}};n(t),o.length?Promise.all(o).then((()=>e())):e()}createIterator(t,e){const s=this.opt.window;return s.document.createNodeIterator(t,e,(()=>s.NodeFilter.FILTER_ACCEPT),!1)}addRemoveStyle(t,e,s){if(s&&!e)return;let r=t.querySelector("style[data-markjs]");s?(r||(r=this.opt.window.document.createElement("style"),r.setAttribute("data-markjs","true"),t.appendChild(r)),r.textContent=e):r&&t.removeChild(r)}isIframe(e){return"IFRAME"===e.tagName&&!t.matches(e,this.opt.exclude)}iterateThroughNodes(t,e,s,r,o){const n=this.opt.window.NodeFilter,a=this.opt.shadowDOM,i=this.opt.iframes;if(i||a){const o=(e&n.SHOW_ELEMENT)>0,h=(e&n.SHOW_TEXT)>0,c=t=>{let l,d=this.createIterator(t,e|n.SHOW_ELEMENT);for(;t=d.nextNode();)if(1===t.nodeType){if(o&&s(t)&&r(t),i&&this.isIframe(t)&&"ready"===this.map.get(t)){const e=t.contentWindow.document;e&&c(e)}a&&(l=t.shadowRoot)&&"open"===l.mode&&(this.addRemoveStyle(l,a.style,h),c(l))}else h&&3===t.nodeType&&s(t)&&r(t)};c(t)}else{const o=this.createIterator(t,e);let n;for(;n=o.nextNode();)s(n)&&r(n)}o()}forEachNode(t,e,s,r=(()=>{})){const o=this.getContexts();let n=o.length;n||r();const a=()=>{o.forEach((o=>{this.iterateThroughNodes(o,t,s,e,(()=>{--n<=0&&r()}))}))};if(this.opt.iframes){let t=n;o.forEach((e=>{this.waitForIframes(e,(()=>{--t<=0&&a()}))}))}else a()}}class e{constructor(t){this.opt=Object.assign({},{diacritics:!0,accuracy:"partially",caseSensitive:!1,ignoreJoiners:!1,ignorePunctuation:[],wildcards:"disabled"},t)}get chars(){return this._chars||(this._chars=[],["aàáảãạăằắẳẵặâầấẩẫậäåāą","cçćč","dđď","eèéẻẽẹêềếểễệëěēę","iìíỉĩịîïī","lł","nñňń","oòóỏõọôồốổỗộơởỡớờợöøōő","rř","sšśșş","tťțţ","uùúủũụưừứửữựûüůūű","yýỳỷỹỵÿ","zžżź"].forEach((t=>{this._chars.push(t,t.toUpperCase())}))),this._chars}create(t){const e=[];let s=0;t=t.map((t=>(this.opt.charSets&&(t=t.replace(/(\\.)+|\[(?:[^\\\]]|(?:\\.))+\](?:[+*?]\??|\{[\d,]+\}\??)?/g,((t,r)=>r?t:(e.push(t),""+s+++""))).replace(/\\(?=\[|\x03)/g,"")),"("+this.createPattern(t)+")")));const r=this.createAccuracy(t.join("|"));return e.length&&(r.pattern=r.pattern.replace(/\x03(\d+)\x03/g,((t,s)=>e[s]))),new RegExp(`${r.lookbehind}(${r.pattern})${r.lookahead}`,"g"+(this.opt.caseSensitive?"":"i"))}createPattern(t){const e="disabled"!==this.opt.wildcards;t=t.replace(/\s+/g," "),e&&(t=this.createPlaceholders(t)),t=t.replace(/[[\]/{}()*+?.\\^$|]/g,"\\$&");const s=this.getJoinersPunctuation();return s&&(t=this.setupIgnoreJoiners(t)),this.opt.diacritics&&(t=this.createDiacritics(t)),t=t.replace(/ /g,"\\s+"),s&&(t=t.split(/\x00+/).join(`[${s}]*`)),e&&(t=this.createWildcards(t)),t}preprocess(t){return t&&t.length?this.distinct("string"==typeof t?t.split(""):t).join("").replace(/[-^\]\\]/g,"\\$&"):""}distinct(t){const e=[];return t.forEach((t=>{t.trim()&&-1===e.indexOf(t)&&e.push(t)})),e}getJoinersPunctuation(){let t=this.preprocess(this.opt.ignorePunctuation);return this.opt.ignoreJoiners&&(t+="\\u00ad\\u200b\\u200c\\u200d"),t}setupIgnoreJoiners(t){return t.replace(/((?:\\\\)+|\x02|\x03\d+\x03|\|)|\\?(?:[\uD800-\uDBFF][\uDC00-\uDFFF]|.)(?=(\x02|\||$)|.)/g,((t,e,s)=>e||void 0!==s?t:t+"\0"))}createPlaceholders(t){return t.replace(/(\\.)+|[?*]/g,((t,e)=>e?t:"?"===t?"":"")).replace(/\\+(?=[?*\x01\x02])/g,(t=>t.slice(1)))}createWildcards(t){const e="withSpaces"===this.opt.wildcards,s=e&&this.opt.boundary?"[^]*?":"[^]*?";return t.replace(/\x01/g,e?"[^]?":"\\S?").replace(/\x02/g,e?s:"\\S*")}createDiacritics(t){const e=this.chars;return t.split("").map((t=>{for(let s=0;s<e.length;s+=2){const r=e[s].includes(t);if(this.opt.caseSensitive){if(r)return"["+e[s]+"]";if(e[s+1].includes(t))return"["+e[s+1]+"]"}else if(r||e[s+1].includes(t))return"["+e[s]+e[s+1]+"]"}return t})).join("")}createAccuracy(t){let e,s=this.opt.accuracy,r="()",o=t,n="";if("partially"!==s){"string"!=typeof s&&(e=this.preprocess(s.limiters),s=s.value),e="\\s"+(e||"!\"#$%&'()*+,\\-./:;<=>?@[\\]\\\\^_`{|}~¡¿");const a=`(^|[${e}])`;if("exactly"===s)r=a,n=`(?=$|[${e}])`;else{const n=`[^${e}]*`;"complementary"===s?o=`${n}(?:${t})${n}`:"startsWith"===s&&(r=a,o=`(?:${t.replace(/\\s\+/g,n+"$&")})${n}`)}}return{lookbehind:r,pattern:o,lookahead:n}}}class s{constructor(t){this.ctx=t,this.nodeNames=["script","style","title","head","html"]}set opt(t){if(!(t&&t.window&&t.window.document)&&"undefined"==typeof window)throw new Error("Mark.js: please provide a window object as an option.");const e=t&&t.window||window;this._opt=Object.assign({},{window:e,element:"",className:"",exclude:[],iframes:!1,iframesTimeout:5e3,separateWordSearch:!0,acrossElements:!1,ignoreGroups:0,each:()=>{},noMatch:()=>{},filter:()=>!0,done:()=>{},debug:!1,log:e.console},t),this._opt.element||(this._opt.element="mark"),this.filter=e.NodeFilter,this.empty=e.document.createTextNode("")}get opt(){return this._opt}get iterator(){return new t(this.ctx,this.opt)}log(t,e="debug"){if(this.opt.debug){const s=this.opt.log;"object"==typeof s&&"function"==typeof s[e]&&s[e](`mark.js: ${t}`)}}report(t){t.forEach((t=>{this.log(`${t.text} ${JSON.stringify(t.obj)}`,t.level||"debug"),t.skip||this.opt.noMatch(t.obj)}))}getSeachTerms(t){const e="string"==typeof t?[t]:t,s=this.opt.separateWordSearch,r=[],o={},n=t=>{t.split(/ +/).forEach((t=>a(t)))},a=t=>{t.trim()&&!r.includes(t)&&(r.push(t),o[t]=0)};return e.forEach((t=>{s?"preserveTerms"===s?t.split(/"("*[^"]+"*)"/).forEach(((t,e)=>{e%2>0?a(t):n(t)})):n(t):a(t)})),r.sort(((t,e)=>e.length-t.length)),{terms:r,termStats:o}}isNumeric(t){return Number(parseFloat(t))==t}checkRanges(t,e,s,r){const o="error",n=t.filter((t=>!!(this.isNumeric(t.start)&&this.isNumeric(t.length)&&(t.start=parseInt(t.start),t.length=parseInt(t.length),t.start>=s&&t.start<r&&t.length>0))||(e.push({text:"Invalid range: ",obj:t,level:o}),!1))).sort(((t,e)=>t.start-e.start));if(this.opt.wrapAllRanges)return n;let a,i=0;return n.filter((t=>(a=t.start+t.length,t.start>=i?(i=a,!0):(e.push({text:(a<i?"Nest":"Overlapp")+"ing range: ",obj:t,level:o}),!1))))}setType(t,e){const s=Array.isArray(e.tagNames)&&e.tagNames.length;if(s&&e.tagNames.forEach((e=>t[e.toLowerCase()]=2)),!s||e.extend)for(const e in t)t[e]=2;t.br=3}getTextNodesAcross(t){const e={div:1,p:1,li:1,td:1,tr:1,th:1,ul:1,ol:1,dd:1,dl:1,dt:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,blockquote:1,figcaption:1,figure:1,pre:1,table:1,thead:1,tbody:1,tfoot:1,input:1,img:1,nav:1,details:1,label:1,form:1,select:1,menu:1,br:3,menuitem:1,main:1,section:1,article:1,aside:1,picture:1,output:1,button:1,header:1,footer:1,address:1,area:1,canvas:1,map:1,fieldset:1,textarea:1,track:1,video:1,audio:1,body:1,iframe:1,meter:1,object:1,svg:1},s=[],r=this.opt.blockElementsBoundary,o=r?2:1;let n,a,i,h="";r&&(this.setType(e,r),r.char&&(h=r.char.charAt(0)));const c={text:"",regex:/\s/,tags:e,boundary:r,str:"",ch:h};this.iterator.forEachNode(this.filter.SHOW_ELEMENT|this.filter.SHOW_TEXT,(t=>{i&&s.push(this.getNodeInfo(i,t,a,c)),a=null,i=t}),(t=>1===t.nodeType?(n=e[t.nodeName.toLowerCase()],3===n&&(c.str+="\n"),a&&n!==o||(a=n),!1):!this.excluded(t.parentNode)),(()=>{i&&s.push(this.getNodeInfo(i,null,a,c)),t({text:c.text,nodes:s,lastIndex:0})}))}getNodeInfo(t,e,s,r){const o=r.text.length,n=r.ch;let a=0,i=r.str,h=t.textContent;if(e){const o=r.regex.test(e.textContent[0]),a=o&&r.regex.test(h[h.length-1]);if(r.boundary||!a){let h=s;if(!s){let o=t.parentNode;for(;o;){if(s=r.tags[o.nodeName.toLowerCase()]){h=!(o===e.parentNode||o.contains(e));break}o=o.parentNode}}h&&(a?2===s&&(i+=a?n:o?" "+n:n+" "):i+=1===s?" ":2===s?" "+n+" ":"")}}return i&&(h+=i,a=i.length,r.str=""),r.text+=h,this.createInfo(t,o,r.text.length-a,a)}getRangesTextNodes(t,e){const s=[],r=/\n/g,o=[0],n=this.filter.SHOW_TEXT|(e?this.filter.SHOW_ELEMENT:0);let a,i="",h=0;this.iterator.forEachNode(n,(t=>{if(e)for(;null!==(a=r.exec(t.textContent));)o.push(h+a.index);i+=t.textContent,s.push({start:h,end:h=i.length,offset:0,node:t})}),(t=>e&&1===t.nodeType?("br"===t.tagName.toLowerCase()&&o.push(h),!1):!this.excluded(t.parentNode)),(()=>{const r={text:i,nodes:s,lastIndex:0};e&&(o.push(h),r.newLines=o),t(r)}))}getTextNodes(t){const e=[];this.iterator.forEachNode(this.filter.SHOW_TEXT,(t=>{e.push(t)}),(t=>!this.excluded(t.parentNode)),(()=>{t({nodes:e,lastIndex:0})}))}excluded(e){return this.nodeNames.includes(e.nodeName.toLowerCase())||t.matches(e,this.opt.exclude)}wrapRangeInsert(t,e,s,r,o,n){const a=r===e.node.textContent.length,i=e.end;let h=1,c=r,l=e.node;0!==s?(l=l.splitText(s),c=r-s,h=a?2:3):a&&(h=0);const d=a?this.empty:l.splitText(c),p=this.wrapTextNode(l),u=p.childNodes[0],g=this.createInfo(d,0===h||2===h?i:e.start+r,i,e.offset);if(0===h)return e.node=u,{mark:p,nodeInfo:g,increment:0};const f=this.createInfo(u,1===h?e.start:o,e.start+r,0);return 1===h?t.nodes.splice(n,1,f,g):(2===h?t.nodes.splice(n+1,0,f):t.nodes.splice(n+1,0,f,g),e.end=o,e.offset=0),{mark:p,nodeInfo:g,increment:h<3?1:2}}createInfo(t,e,s,r){return{node:t,start:e,end:s,offset:r}}wrapRange(t,e,s,r){let o,n=s===t.textContent.length,a=s;return 0!==e&&(t=t.splitText(e),a=s-e),o=n?this.empty:t.splitText(a),r(this.wrapTextNode(t)),o}wrapTextNode(t){let e=this.opt.window.document.createElement(this.opt.element);return e.setAttribute("data-markjs","true"),this.opt.className&&e.setAttribute("class",this.opt.className),e.textContent=t.textContent,t.parentNode.replaceChild(e,t),e}wrapRangeAcross(t,e,s,r,o){let n=t.lastIndex,a=!0;const i=this.opt.wrapAllRanges;if(i)for(;n>0&&t.nodes[n].start>e;)n--;for(;n<t.nodes.length;n++)if(n+1===t.nodes.length||t.nodes[n+1].start>e){let h=t.nodes[n];if(!r(h.node))break;const c=e-h.start,l=(s>h.end?h.end:s)-h.start;if(c>=0&&l>c){if(i){const s=this.wrapRangeInsert(t,h,c,l,e,n);h=s.nodeInfo,o(s.mark,a)}else h.node=this.wrapRange(h.node,c,l,(t=>{o(t,a)})),h.start+=l,t.lastTextIndex=h.start;a=!1}if(!(s>h.end))break;e=h.end+h.offset}t.lastIndex=n}wrapGroups(t,e,s,r,o){let n,a,i=0,h=0,c=0,l=!1,d=0;for(;++c<e.length;)n=e[c],n&&(a=e.indices[c][0],a>=i&&(d=e.indices[c][1],r(t,n,c)&&(t=this.wrapRange(t,a-h,d-h,(t=>{o(t,c)})),d>i&&(i=d),h=d,l=!0)));return l?s.lastIndex=0:0===e[0].length&&this.setLastIndex(s,d),t}wrapGroupsAcross(t,e,s,r,o){let n,a,i,h=0,c=0,l=0;for(;++c<e.length;)n=e[c],n&&(a=e.indices[c][0],(this.opt.wrapAllRanges||a>=h)&&(l=e.indices[c][1],i=!1,this.wrapRangeAcross(t,a,l,(t=>r(t,n,c)),((t,e)=>{i=!0,o(t,c,e)})),i&&l>h&&(h=l)));0===e[0].length&&this.setLastIndex(s,l)}setLastIndex(t,e){const s=t.lastIndex;t.lastIndex=e>s?e:e>0?s+1:1/0}wrapSeparateGroups(t,e,s,r,o){const n=this.opt.acrossElements,a=n?"wrapGroupsAcross":"wrapGroups",i={abort:!1},h={execution:i};let c,l,d,p,u=0;const g=e=>{for(;null!==(l=t.exec(n?e.text:e.textContent))&&(h.match=l,d=p=!0,c=this[a](e,l,t,((t,e,r)=>(h.matchStart=d,h.groupIndex=r,d=!1,s(t,e,h))),((t,e,s)=>{p&&u++;r(t,{match:l,matchStart:p,count:u,groupIndex:e,groupStart:s}),p=!1})),e=c||e,!i.abort););};n?this.getTextNodesAcross((t=>{g(t)})):this.getTextNodes((t=>{t.nodes.every((t=>(g(t),!i.abort)))})),o(u)}wrapMatches(t,e,s,r,o){const n=0===e?0:e+1,a={abort:!1},i={execution:a};let h,c,l=0;this.getTextNodes((e=>{e.nodes.every((e=>{for(;null!==(h=t.exec(e.textContent));){if(""===(c=h[n])){t.lastIndex++;continue}if(i.match=h,!s(e,c,i))continue;let o=0,d=h.index;for(;++o<n;)h[o]&&(d+=h[o].length);const p=d+c.length;if(e=this.wrapRange(e,d,p,(t=>{r(t,{match:h,count:++l})})),t.lastIndex=0,a.abort)break}return!a.abort})),o(l)}))}wrapMatchesAcross(t,e,s,r,o){const n=0===e?0:e+1,a={abort:!1},i={execution:a};let h,c,l,d=0;this.getTextNodesAcross((e=>{for(;null!==(h=t.exec(e.text));){if(""===(c=h[n])){t.lastIndex++;continue}i.match=h,l=!0;let o=0,p=h.index;for(;++o<n;)h[o]&&(p+=h[o].length);if(this.wrapRangeAcross(e,p,p+c.length,(t=>(i.matchStart=l,l=!1,s(t,c,i))),((t,e)=>{e&&d++,r(t,{match:h,matchStart:e,count:d})})),a.abort)break}o(d)}))}wrapRanges(t,e,s,r){const o=this.opt.markLines,n=[],a=[],i="warn";let h=0;this.getRangesTextNodes((c=>{const l=o?c.newLines.length:c.text.length,d=this.checkRanges(t,n,o?1:0,l);d.forEach(((t,r)=>{let d=t.start,p=d+t.length;p>l&&(n.push({text:`Range was limited to: ${l}`,obj:t,skip:!0,level:i}),p=l),o&&(d=c.newLines[d-1],"\n"===c.text[d]&&d++,p=c.newLines[p-1]);const u=c.text.substring(d,p);u.trim()?this.wrapRangeAcross(c,d,p,(s=>e(s,t,u,r)),((e,r)=>{r&&h++,s(e,t,{matchStart:r,count:h})})):(n.push({text:"Skipping whitespace only range: ",obj:t,level:i}),a.push(t))})),this.log(`Valid ranges: ${JSON.stringify(d.filter((t=>!a.includes(t))))}`),r(h,n)}),o)}unwrapMatches(t){const e=t.parentNode,s=t.firstChild;if(1===t.childNodes.length)if(3===s.nodeType){const r=t.previousSibling,o=t.nextSibling;if(r&&3===r.nodeType)o&&3===o.nodeType?(r.nodeValue+=s.nodeValue+o.nodeValue,e.removeChild(o)):r.nodeValue+=s.nodeValue;else{if(!o||3!==o.nodeType)return void e.replaceChild(t.firstChild,t);o.nodeValue=s.nodeValue+o.nodeValue}e.removeChild(t)}else e.replaceChild(t.firstChild,t);else{if(s){let s=this.opt.window.document.createDocumentFragment();for(;t.firstChild;)s.appendChild(t.removeChild(t.firstChild));e.replaceChild(s,t)}else e.removeChild(t);e.normalize()}}markRegExp(t,e){this.opt=e;let s=0,r=0,o=this.opt.acrossElements,n=this.opt.separateGroups?"wrapSeparateGroups":o?"wrapMatchesAcross":"wrapMatches";if(!t.global&&!t.sticky){let e=t.toString().split("/");t=new RegExp(t.source,"g"+e[e.length-1]),this.log("RegExp is recompiled - it must have a `g` flag","warn")}this.log(`RegExp "${t}"`),this[n](t,this.opt.ignoreGroups,((t,e,s)=>this.opt.filter(t,e,r,s)),((t,e)=>{r=e.count,s++,this.opt.each(t,e)}),(e=>{0===e&&this.opt.noMatch(t),this.opt.done(s,e)}))}mark(t,e){this.opt=e;const{terms:s,termStats:r}=this.getSeachTerms(t);if(!s.length)return void this.opt.done(0,0,r);let o,n,a=0,i=0,h=0;const c=this.opt.acrossElements,l=c?"wrapMatchesAcross":"wrapMatches",d=this.getRegExps(s),p=({regex:t,regTerms:e})=>{this.log(`RegExp ${t}`),this[l](t,1,((t,s,a)=>(c&&!a.matchStart||(o=this.getCurrentTerm(a.match,e)),n=r[o],this.opt.filter(t,o,h+n,n,a))),((t,e)=>{i++,c&&!e.matchStart||(r[o]+=1),this.opt.each(t,e)}),(t=>{h+=t;const s=e.filter((t=>0===r[t]));s.length&&this.opt.noMatch(s),++a<d.length?p(d[a]):this.opt.done(i,h,r)}))};p(d[0])}getCurrentTerm(t,e){let s=t.length;for(;--s>2;)if(t[s])return e[s-3];return" "}getRegExps(t){const s=new e(this.opt),r=this.opt.combineBy||this.opt.combinePatterns,o=[];let n,a=10;r===1/0?a=Math.pow(2,31):!isNaN(+r)&&(n=parseInt(r))>0&&(a=n);for(let e=0;e<t.length;e+=a){const r=t.slice(e,Math.min(e+a,t.length));o.push({regex:s.create(r),regTerms:r})}return o}markRanges(t,e){if(this.opt=e,Array.isArray(t)){let e=0;this.wrapRanges(t,((t,e,s,r)=>this.opt.filter(t,e,s,r)),((t,s,r)=>{e++,this.opt.each(t,s,r)}),((t,s)=>{this.report(s),this.opt.done(e,t)}))}else this.report([{text:"markRanges() accept an array of objects: ",obj:t,level:"error"}]),this.opt.done(0,0)}unmark(e){this.opt=e;let s=this.opt.element+"[data-markjs]";this.opt.className&&(s+=`.${this.opt.className}`),this.log(`Removal selector "${s}"`),this.iterator.forEachNode(this.filter.SHOW_ELEMENT,(t=>{this.unwrapMatches(t)}),(e=>t.matches(e,s)&&!this.excluded(e)),this.opt.done)}}$.fn.mark=function(t,e){return new s(this.get()).mark(t,e),this},$.fn.markRegExp=function(t,e){return new s(this.get()).markRegExp(t,e),this},$.fn.markRanges=function(t,e){return new s(this.get()).markRanges(t,e),this},$.fn.unmark=function(t){return new s(this.get()).unmark(t),this},$.fn.getVersion=function(){return"2.6.0"};var r=$;export{r as default};
