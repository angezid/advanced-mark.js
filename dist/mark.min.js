/*!***************************************************
* mark.js v10.0.0
* https://markjs.io/
* Copyright (c) 2014–2022, Julian Kühnel
* Released under the MIT license https://git.io/vwTVl
*****************************************************/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Mark=t()}(this,(function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(this,arguments)}var a=function(){function e(n){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];t(this,e),this.ctx=n,this.iframes=r,this.exclude=o,this.iframesTimeout=a,this.shadowDOM=i}return r(e,[{key:"getContexts",value:function(){var e=[];return(void 0!==this.ctx&&this.ctx?NodeList.prototype.isPrototypeOf(this.ctx)?Array.prototype.slice.call(this.ctx):Array.isArray(this.ctx)?this.ctx:"string"==typeof this.ctx?Array.prototype.slice.call(document.querySelectorAll(this.ctx)):[this.ctx]:[]).forEach((function(t){var n=e.filter((function(e){return e.contains(t)})).length>0;-1!==e.indexOf(t)||n||e.push(t)})),e}},{key:"getIframeContents",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};try{var o=e.contentWindow;if(n=o.document,!o||!n)throw new Error("iframe inaccessible")}catch(e){r()}n&&t(n)}},{key:"isIframeBlank",value:function(e){var t="about:blank",n=e.getAttribute("src").trim();return e.contentWindow.location.href===t&&n!==t&&n}},{key:"observeIframeLoad",value:function(e,t,n){var r=this,o=!1,a=null,i=function i(){if(!o){o=!0,clearTimeout(a);try{r.isIframeBlank(e)||(e.removeEventListener("load",i),r.getIframeContents(e,t,n))}catch(e){n()}}};e.addEventListener("load",i),a=setTimeout(i,this.iframesTimeout)}},{key:"onIframeReady",value:function(e,t,n){try{"complete"===e.contentWindow.document.readyState?this.isIframeBlank(e)?this.observeIframeLoad(e,t,n):this.getIframeContents(e,t,n):this.observeIframeLoad(e,t,n)}catch(e){n()}}},{key:"waitForIframes",value:function(e,t){var n=this,r=0;this.forEachIframe(e,(function(){return!0}),(function(e){r++,n.waitForIframes(e.querySelector("html"),(function(){--r||t()}))}),(function(e){e||t()}))}},{key:"forEachIframe",value:function(t,n,r){var o=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i=t.querySelectorAll("iframe"),s=i.length,c=0;i=Array.prototype.slice.call(i);var u=function(){--s<=0&&a(c)};s||u(),i.forEach((function(t){e.matches(t,o.exclude)?u():o.onIframeReady(t,(function(e){n(t)&&(c++,r(e)),u()}),u)}))}},{key:"createIterator",value:function(e,t,n){return document.createNodeIterator(e,t,n)}},{key:"iterateNodesIncludeShadowDOM",value:function(e,t,n,r){var o=this,a=t===NodeFilter.SHOW_TEXT,i=this.shadowDOM.style?this.createStyleElement():null;a&&(t=NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);!function e(s){for(var c=o.createIterator(s,t);s=c.nextNode();)s.nodeType===Node.ELEMENT_NODE?(a||n(s)!==NodeFilter.FILTER_ACCEPT||r(s),s.shadowRoot&&"open"===s.shadowRoot.mode&&(o.addRemoveStyle(s.shadowRoot,i,a),e(s.shadowRoot))):a&&s.nodeType===Node.TEXT_NODE&&n(s)===NodeFilter.FILTER_ACCEPT&&r(s)}(e)}},{key:"addRemoveStyle",value:function(e,t,n){if(n){if(!t||!e.firstChild||e.querySelector("style[data-markjs]"))return;e.insertBefore(t,e.firstChild)}else{var r=e.querySelector("style[data-markjs]");r&&e.removeChild(r)}}},{key:"createStyleElement",value:function(){var e=document.createElement("style");return e.setAttribute("data-markjs","true"),e.textContent=this.shadowDOM.style,e}},{key:"createInstanceOnIframe",value:function(t){return new e(t.querySelector("html"),this.iframes)}},{key:"compareNodeIframe",value:function(e,t,n){if(e.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_PRECEDING){if(null===t)return!0;if(t.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_FOLLOWING)return!0}return!1}},{key:"getIteratorNode",value:function(e){var t=e.previousNode();return{prevNode:t,node:(null===t||e.nextNode())&&e.nextNode()}}},{key:"checkIframeFilter",value:function(e,t,n,r){var o=!1,a=!1;return r.forEach((function(e,t){e.val===n&&(o=t,a=e.handled)})),this.compareNodeIframe(e,t,n)?(!1!==o||a?!1===o||a||(r[o].handled=!0):r.push({val:n,handled:!0}),!0):(!1===o&&r.push({val:n,handled:!1}),!1)}},{key:"handleOpenIframes",value:function(e,t,n,r){var o=this;e.forEach((function(e){e.handled||o.getIframeContents(e.val,(function(e){o.createInstanceOnIframe(e).forEachNode(t,n,r)}))}))}},{key:"iterateThroughNodes",value:function(e,t,n,r,o){var a=this;if(this.iframes)!function(){for(var o,i,s,c=[],u=[],l=a.createIterator(t,e,r);s=void 0,s=a.getIteratorNode(l),i=s.prevNode,o=s.node;)a.forEachIframe(t,(function(e){return a.checkIframeFilter(o,i,e,c)}),(function(t){a.createInstanceOnIframe(t).forEachNode(e,(function(e){return u.push(e)}),r)})),u.push(o);u.forEach((function(e){n(e)})),a.handleOpenIframes(c,e,n,r)}();else if(this.shadowDOM)this.iterateNodesIncludeShadowDOM(t,e,r,n);else for(var i,s=this.createIterator(t,e,r);i=s.nextNode();)n(i);o()}},{key:"forEachNode",value:function(e,t,n){var r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},a=this.getContexts(),i=a.length;i||o(),a.forEach((function(a){var s=function(){r.iterateThroughNodes(e,a,t,n,(function(){--i<=0&&o()}))};r.iframes?r.waitForIframes(a,s):s()}))}}],[{key:"matches",value:function(e,t){var n="string"==typeof t?[t]:t;if(!n)return!1;var r=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;if(r){var o=!1;return n.every((function(t){return!r.call(e,t)||(o=!0,!1)})),o}return!1}}]),e}(),i=function(){function e(n){t(this,e),this.opt=o({},{diacritics:!0,synonyms:{},accuracy:"partially",caseSensitive:!1,ignoreJoiners:!1,ignorePunctuation:[],wildcards:"disabled"},n)}return r(e,[{key:"create",value:function(e,t){return"disabled"!==this.opt.wildcards&&(e=this.setupWildcardsRegExp(e)),e=this.escapeStr(e),Object.keys(this.opt.synonyms).length&&(e=this.createSynonymsRegExp(e)),(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(e=this.setupIgnoreJoinersRegExp(e)),this.opt.diacritics&&(e=this.createDiacriticsRegExp(e)),e=this.createMergedBlanksRegExp(e),(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(e=this.createJoinersRegExp(e)),"disabled"!==this.opt.wildcards&&(e=this.createWildcardsRegExp(e)),t?this.createAccuracyRegExp(e,!0):(e=this.createAccuracyRegExp(e,!1),new RegExp(e,"gm".concat(this.opt.caseSensitive?"":"i")))}},{key:"createCombinePattern",value:function(e,t){if(!e)return null;for(var n=t?"(":"(?:",r="",o="",a="",i=0;i<e.length;i++){var s=this.create(e[i],!0);0===i&&(r=s.lookbehind,a=s.lookahead),o+="".concat(n).concat(s.pattern,")").concat(i+1<e.length?"|":"")}return{lookbehind:r,pattern:o,lookahead:a}}},{key:"sortByLength",value:function(e){return e.sort((function(e,t){return e.length===t.length?e>t?1:-1:t.length-e.length}))}},{key:"escapeStr",value:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}},{key:"createSynonymsRegExp",value:function(e){var t=this,n=this.opt.synonyms,r=this.opt.caseSensitive?"":"i",o=this.opt.ignoreJoiners||this.opt.ignorePunctuation.length?"\0":"";for(var a in n)if(n.hasOwnProperty(a)){var i=Array.isArray(n[a])?n[a]:[n[a]];i.unshift(a),(i=this.sortByLength(i).map((function(e){return"disabled"!==t.opt.wildcards&&(e=t.setupWildcardsRegExp(e)),e=t.escapeStr(e)})).filter((function(e){return""!==e}))).length>1&&(e=e.replace(new RegExp("(".concat(i.map((function(e){return t.escapeStr(e)})).join("|"),")"),"gm".concat(r)),o+"(".concat(i.map((function(e){return t.processSynonyms(e)})).join("|"),")")+o))}return e}},{key:"processSynonyms",value:function(e){return(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(e=this.setupIgnoreJoinersRegExp(e)),e}},{key:"setupWildcardsRegExp",value:function(e){return(e=e.replace(/(?:\\)*\?/g,(function(e){return"\\"===e.charAt(0)?"?":""}))).replace(/(?:\\)*\*/g,(function(e){return"\\"===e.charAt(0)?"*":""}))}},{key:"createWildcardsRegExp",value:function(e){var t="withSpaces"===this.opt.wildcards;return e.replace(/\u0001/g,t?"[\\S\\s]?":"\\S?").replace(/\u0002/g,t?"[\\S\\s]*?":"\\S*")}},{key:"setupIgnoreJoinersRegExp",value:function(e){return e.replace(/[^(|)\\]/g,(function(e,t,n){var r=n.charAt(t+1);return/[(|)\\]/.test(r)||""===r?e:e+"\0"}))}},{key:"createJoinersRegExp",value:function(e){var t=[],n=this.opt.ignorePunctuation;return Array.isArray(n)&&n.length&&t.push(this.escapeStr(n.join(""))),this.opt.ignoreJoiners&&t.push("\\u00ad\\u200b\\u200c\\u200d"),t.length?e.split(/\u0000+/).join("[".concat(t.join(""),"]*")):e}},{key:"createDiacriticsRegExp",value:function(e){var t=this.opt.caseSensitive?"":"i",n=this.opt.caseSensitive?["aàáảãạăằắẳẵặâầấẩẫậäåāą","AÀÁẢÃẠĂẰẮẲẴẶÂẦẤẨẪẬÄÅĀĄ","cçćč","CÇĆČ","dđď","DĐĎ","eèéẻẽẹêềếểễệëěēę","EÈÉẺẼẸÊỀẾỂỄỆËĚĒĘ","iìíỉĩịîïī","IÌÍỈĨỊÎÏĪ","lł","LŁ","nñňń","NÑŇŃ","oòóỏõọôồốổỗộơởỡớờợöøō","OÒÓỎÕỌÔỒỐỔỖỘƠỞỠỚỜỢÖØŌ","rř","RŘ","sšśșş","SŠŚȘŞ","tťțţ","TŤȚŢ","uùúủũụưừứửữựûüůū","UÙÚỦŨỤƯỪỨỬỮỰÛÜŮŪ","yýỳỷỹỵÿ","YÝỲỶỸỴŸ","zžżź","ZŽŻŹ"]:["aàáảãạăằắẳẵặâầấẩẫậäåāąAÀÁẢÃẠĂẰẮẲẴẶÂẦẤẨẪẬÄÅĀĄ","cçćčCÇĆČ","dđďDĐĎ","eèéẻẽẹêềếểễệëěēęEÈÉẺẼẸÊỀẾỂỄỆËĚĒĘ","iìíỉĩịîïīIÌÍỈĨỊÎÏĪ","lłLŁ","nñňńNÑŇŃ","oòóỏõọôồốổỗộơởỡớờợöøōOÒÓỎÕỌÔỒỐỔỖỘƠỞỠỚỜỢÖØŌ","rřRŘ","sšśșşSŠŚȘŞ","tťțţTŤȚŢ","uùúủũụưừứửữựûüůūUÙÚỦŨỤƯỪỨỬỮỰÛÜŮŪ","yýỳỷỹỵÿYÝỲỶỸỴŸ","zžżźZŽŻŹ"],r=[];return e.split("").forEach((function(o){n.every((function(n){if(-1!==n.indexOf(o)){if(r.indexOf(n)>-1)return!1;e=e.replace(new RegExp("[".concat(n,"]"),"gm".concat(t)),"[".concat(n,"]")),r.push(n)}return!0}))})),e}},{key:"createMergedBlanksRegExp",value:function(e){return e.replace(/[\s]+/gim,"[\\s]+")}},{key:"createAccuracyRegExp",value:function(e,t){var n=this,r=this.opt.accuracy,o="string"==typeof r?r:r.value,a="string"==typeof r?[]:r.limiters,i="";a.forEach((function(e){i+="|".concat(n.escapeStr(e))}));var s,c="()",u="";switch(o){case"partially":default:s=e;break;case"complementary":i="\\s"+(i||this.escapeStr("!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~¡¿")),s="[^".concat(i,"]*").concat(e,"[^").concat(i,"]*");break;case"exactly":c="(^|\\s".concat(i,")"),s=e,u="(?=$|\\s".concat(i,")")}return t?{lookbehind:c,pattern:s,lookahead:u}:"".concat(c,"(").concat(s,")").concat(u)}}]),e}(),s=function(){function n(e){t(this,n),this.version="10.0.0",this.ctx=e,this.cacheDict={},this.ie=!1;var r=window.navigator.userAgent;(r.indexOf("MSIE")>-1||r.indexOf("Trident")>-1)&&(this.ie=!0)}return r(n,[{key:"opt",get:function(){return this._opt},set:function(e){this._opt=o({},{element:"",className:"",exclude:[],iframes:!1,iframesTimeout:5e3,separateWordSearch:!0,acrossElements:!1,separateGroups:!1,combinePatterns:!1,cacheTextNodes:!1,wrapAllRanges:!1,ignoreGroups:0,each:function(){},noMatch:function(){},filter:function(){return!0},done:function(){},debug:!1,log:window.console},e)}},{key:"iterator",get:function(){return new a(this.ctx,this.opt.iframes,this.opt.exclude,this.opt.iframesTimeout,this.opt.shadowDOM)}},{key:"log",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"debug",r=this.opt.log;this.opt.debug&&"object"===e(r)&&"function"==typeof r[n]&&r[n]("mark.js: ".concat(t))}},{key:"checkOption",value:function(e){return e&&e.acrossElements&&e.cacheTextNodes&&!e.wrapAllRanges&&(e=o({},{wrapAllRanges:!0},e)),e}},{key:"getSeparatedKeywords",value:function(e){var t=this,n=[];return e.forEach((function(e){t.opt.separateWordSearch?e.split(" ").forEach((function(e){e.trim()&&-1===n.indexOf(e)&&n.push(e)})):e.trim()&&-1===n.indexOf(e)&&n.push(e)})),{keywords:n.sort((function(e,t){return t.length-e.length})),length:n.length}}},{key:"isNumeric",value:function(e){return Number(parseFloat(e))==e}},{key:"checkRanges",value:function(e){var t=this;if(!Array.isArray(e)||"[object Object]"!==Object.prototype.toString.call(e[0]))return this.log("markRanges() will only accept an array of objects"),this.opt.noMatch(e),[];var n=[],r=0;return e.sort((function(e,t){return e.start-t.start})).forEach((function(e){var o=t.callNoMatchOnInvalidRanges(e,r),a=o.start,i=o.end;o.valid&&(e.start=a,e.length=i-a,n.push(e),t.opt.wrapAllRanges||(r=i))})),n}},{key:"callNoMatchOnInvalidRanges",value:function(e,t){var n,r,o=!1;return e&&void 0!==e.start?(r=(n=parseInt(e.start,10))+parseInt(e.length,10),this.isNumeric(e.start)&&this.isNumeric(e.length)&&n>=t&&r>n?o=!0:(this.log("Ignoring invalid or overlapping range: "+"".concat(JSON.stringify(e))),this.opt.noMatch(e))):(this.log("Ignoring invalid range: ".concat(JSON.stringify(e))),this.opt.noMatch(e)),{start:n,end:r,valid:o}}},{key:"checkWhitespaceRanges",value:function(e,t,n){var r,o=!0,a=n.length,i=t-a,s=parseInt(e.start,10)-i;return(r=(s=s>a?a:s)+parseInt(e.length,10))>a&&(r=a,this.log("End range automatically set to the max value of ".concat(a))),s<0||r-s<=0?(o=!1,this.log("Invalid range: ".concat(JSON.stringify(e))),this.opt.noMatch(e)):/\S/.test(n.substring(s,r))||(o=!1,this.log("Skipping whitespace only range: "+JSON.stringify(e)),this.opt.noMatch(e)),{start:s,end:r,valid:o}}},{key:"checkParents",value:function(e,t){if(e===e.parentNode.lastChild){if(t(e.parentNode))return!0;for(var n=e.parentNode;n.parentNode&&n===n.parentNode.lastChild;){if(t(n.parentNode))return!0;n=n.parentNode}var r=e.parentNode.nextSibling;if(r){if(1!==r.nodeType)return!0;if(t(r))return!0}}return!1}},{key:"checkNextSiblings",value:function(e,t){if(e&&1===e.nodeType){if(t(e))return;if(e.firstChild){for(var n,r=e.firstChild;r;){if(1!==r.nodeType)return;if(t(r))return;n=r,r=r.firstChild}this.checkNextSiblings(n.nextSibling,t)}e!==e.parentNode.lastChild?this.checkNextSiblings(e.nextSibling,t):t(e.parentNode)}}},{key:"prepare",value:function(e){var t=" ",n=this.opt.blockElementsBoundary;if(n.tagNames&&n.tagNames.length){var r={};for(var o in n.tagNames)r[n.tagNames[o].toLowerCase()]=1;for(var a in r)e[a]=2}else{for(var i in e)e[i]=2;e.br=1}return n.char&&(t=n.char.charAt(0)+" "),t}},{key:"getTextNodesAcrossElements",value:function(e){var t=this;if(this.opt.cacheTextNodes&&this.cacheDict.nodes)return this.cacheDict.lastIndex=0,this.cacheDict.lastTextIndex=0,void e(this.cacheDict);var n,r,o,a,i,s,c,u="",l=0,h=[],f=this.opt.blockElementsBoundary,d={div:1,p:1,li:1,td:1,tr:1,th:1,ul:1,ol:1,br:1,dd:1,dl:1,dt:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,blockquote:1,figcaption:1,figure:1,pre:1,table:1,thead:1,tbody:1,tfoot:1,input:1,img:1,nav:1,details:1,label:1,form:1,select:1,menu:1,menuitem:1,main:1,section:1,article:1,aside:1,picture:1,output:1,button:1,header:1,footer:1,address:1,area:1,canvas:1,map:1,fieldset:1,textarea:1,track:1,video:1,audio:1,body:1,iframe:1,meter:1,object:1,svg:1};f&&(s=this.prepare(d),c=" "+s),this.iterator.forEachNode(NodeFilter.SHOW_TEXT,(function(e){(i=0,n=u.length,r=e.textContent,o=/\s/.test(r[r.length-1]),f||!o)&&(t.checkParents(e,(function(e){return a=d[e.nodeName.toLowerCase()]}))||t.checkNextSiblings(e.nextSibling,(function(e){return a=d[e.nodeName.toLowerCase()]})),a&&(o?2===a&&(u+=r+s,i=2):1===a?(u+=r+" ",i=1):2===a&&(u+=r+c,i=3)));0===i&&(u+=r),h.push({start:n,end:u.length-i,offset:i,startOffset:l,node:e}),l-=i}),(function(e){return t.matchesExclude(e.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}),(function(){var n={value:u,nodes:h,lastIndex:0,lastTextIndex:0};t.opt.cacheTextNodes&&(t.cacheDict=n),e(n)}))}},{key:"getTextNodes",value:function(e){var t=this;if(this.opt.cacheTextNodes&&this.cacheDict.nodes)e(this.cacheDict);else{var n="",r=[];this.iterator.forEachNode(NodeFilter.SHOW_TEXT,(function(e){r.push({start:n.length,end:(n+=e.textContent).length,offset:0,node:e})}),(function(e){return t.matchesExclude(e.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}),(function(){var o={value:n,nodes:r,lastIndex:0,lastTextIndex:0};t.opt.cacheTextNodes&&(t.cacheDict=o),e(o)}))}}},{key:"matchesExclude",value:function(e){return-1!==["SCRIPT","STYLE","TITLE","HEAD","HTML"].indexOf(e.nodeName.toUpperCase())||this.opt.exclude&&this.opt.exclude.length&&a.matches(e,this.opt.exclude)}},{key:"wrapRangeInTextNode",value:function(e,t,n){var r=e.splitText(t),o=r.splitText(n-t);return this.createMarkElement(r),o}},{key:"createMarkElement",value:function(e){var t=this.opt.element?this.opt.element:"mark",n=document.createElement(t);return n.setAttribute("data-markjs","true"),this.opt.className&&n.setAttribute("class",this.opt.className),n.textContent=e.textContent,e.parentNode.replaceChild(n,e),n}},{key:"wrapRangeInTextNodeInsert",value:function(e,t,n,r,o,a){var i=r===t.node.textContent.length;if(0===n&&i){var s=this.createMarkElement(t.node);return t.node=s.childNodes[0],{retNode:t,markNode:s,increment:0}}var c=t.node.splitText(n),u=c.splitText(r-n),l=this.createMarkElement(c),h=1,f={start:o,end:t.start+r,offset:0,node:l.childNodes[0]},d={start:t.start+r,end:t.end,offset:t.offset,node:u};return 0===n?e.nodes.splice(a,1,f,d):(i?e.nodes.splice(a+1,0,f):(e.nodes.splice(a+1,0,f,d),h=2),t.end=o,t.offset=0),{retNode:d,markNode:l,increment:h}}},{key:"wrapRangeInMappedTextNode",value:function(e,t,n,r,o){var a=e.lastIndex,i=!0;if(this.opt.wrapAllRanges)for(;a>=0&&e.nodes[a].start>t;)a--;else if(t<e.lastTextIndex)return;for(;a<e.nodes.length;a++)if(a+1===e.nodes.length||e.nodes[a+1].start>t){var s=e.nodes[a];if(!r(s)){a>e.lastIndex&&(e.lastIndex=a);break}var c=t-s.start,u=(n>s.end?s.end:n)-s.start;if(c>=0&&u>c){if(this.opt.wrapAllRanges){var l=this.wrapRangeInTextNodeInsert(e,s,c,u,t,a);s=l.retNode,o(l.markNode,i)}else s.node=this.wrapRangeInTextNode(s.node,c,u),s.start+=u,e.lastTextIndex=s.start,o(s.node.previousSibling,i);i=!1}if(!(n>s.end)){e.lastIndex=a;break}t=s.end+s.offset}}},{key:"wrapGroups",value:function(e,t,n,r){return r((e=this.wrapRangeInTextNode(e,t,t+n)).previousSibling),e}},{key:"separateGroupsD",value:function(e,t,n,r,o){for(var a,i,s=0,c=0,u=0,l=!1,h=0;++u<t.length;)(a=t[u])&&(i=t.indices[u][0])>=s&&(h=t.indices[u][1],r(a,e,u)&&(e=this.wrapGroups(e,i-c,h-i,(function(e){o(e,u)})),h>s&&(s=h),c=h,l=!0));return l?n.regex.lastIndex=0:0===t[0].length&&this.setLastIndex(n.regex,h),e}},{key:"separateGroups",value:function(e,t,n,r,o){for(var a,i,s,c=t.index,u=-1,l=!1;++u<n.groups.length;)(i=t[a=n.groups[u]])&&-1!==(s=e.textContent.indexOf(i,c))&&(r(i,e,a)?(e=this.wrapGroups(e,s,i.length,(function(e){o(e,a)})),c=0,l=!0):c=s+i.length);return l&&(n.regex.lastIndex=0),e}},{key:"wrapMatchGroupsD",value:function(e,t,n,r,o){for(var a,i,s,c=0,u=0,l=0;++u<t.length;)(a=t[u])&&(i=t.indices[u][0],(this.opt.wrapAllRanges||i>=c)&&(l=t.indices[u][1],s=!1,this.wrapRangeInMappedTextNode(e,i,l,(function(e){return r(a,e.node,u)}),(function(e,t){s=!0,o(e,t,u)})),s&&l>c&&(c=l)));0===t[0].length&&this.setLastIndex(n.regex,l)}},{key:"setLastIndex",value:function(e,t){t>e.lastIndex?e.lastIndex=t:t>0?e.lastIndex++:e.lastIndex=1/0}},{key:"wrapMatchGroups",value:function(e,t,n,r,o){var a,i,s,c=0,u=0,l=t.index,h=t[0];this.opt.wrapAllRanges&&this.wrapRangeInMappedTextNode(e,l,l+h.length,(function(e){return r(h,e.node,u)}),(function(e,t){o(e,t,u)}));for(var f=0;f<n.groups.length;f++)u=n.groups[f],(a=t[u])&&(s=(i=h.indexOf(a,c))+a.length,-1!==i&&(this.wrapRangeInMappedTextNode(e,l+i,l+s,(function(e){return r(a,e.node,u)}),(function(e,t){o(e,t,u)})),c=s))}},{key:"collectRegexGroupIndexes",value:function(e){for(var t=[],n=[],r=-1,o=1,a=0,i=!1,s=e.source,c=/^\(\?<(?![=!])|^\((?!\?)/;++r<s.length;)switch(s[r]){case"(":i||(c.test(s.substring(r))?(n.push(1),0===a&&t.push(o),a++,o++):n.push(0));break;case")":i||1!==n.pop()||a--;break;case"\\":r++;break;case"[":i=!0;break;case"]":i=!1}return t}},{key:"wrapSeparateGroups",value:function(e,t,n,r,o){var a,i,s,c,u=this,l=e.hasIndices?"separateGroupsD":"separateGroups",h={regex:e,groups:e.hasIndices?{}:this.collectRegexGroupIndexes(e)},f={abort:!1},d={execution:f},p=0;this.getTextNodes((function(t){t.nodes.every((function(t){for(a=t.node,d.offset=t.start;null!==(i=e.exec(a.textContent))&&(e.hasIndices||""!==i[0])&&(d.match=i,s=c=!0,a=u[l](a,i,h,(function(e,t,r){return d.matchStart=s,d.groupIndex=r,s=!1,n(e,t,d)}),(function(e,t){c&&p++,r(e,{match:i,matchStart:c,count:p,groupIndex:t}),c=!1})),!f.abort););return!f.abort})),o(p)}))}},{key:"wrapMatches",value:function(e,t,n,r,o){var a,i,s,c=this,u=0===t?0:t+1,l={abort:!1},h={execution:l},f=0;this.getTextNodes((function(t){for(var d=0;d<t.nodes.length;d++){for(a=t.nodes[d],i=a.node;null!==(s=e.exec(i.textContent))&&""!==s[u];)if(h.match=s,h.offset=a.start,n(s[u],i,h)){var p=s[u].length,g=s.index;if(0!==u)for(var v=1;v<u;v++)g+=s[v].length;if(c.opt.cacheTextNodes){var m=c.wrapRangeInTextNodeInsert(t,a,g,g+p,a.start+g,d);if(f++,r(m.markNode,{match:s,count:f}),0===m.increment){e.lastIndex=0;break}d+=m.increment,a=m.retNode,i=a.node}else i=c.wrapGroups(i,g,p,(function(e){f++,r(e,{match:s,count:f})}));if(e.lastIndex=0,l.abort)break}if(l.abort)break}o(f)}))}},{key:"wrapGroupsAcrossElements",value:function(e,t,n,r,o){var a,i,s,c=this,u=e.hasIndices?"wrapMatchGroupsD":"wrapMatchGroups",l={regex:e,groups:e.hasIndices?{}:this.collectRegexGroupIndexes(e)},h={abort:!1},f={execution:h},d=0;this.getTextNodesAcrossElements((function(t){for(;null!==(a=e.exec(t.value))&&(e.hasIndices||""!==a[0])&&(f.match=a,i=s=!0,c[u](t,a,l,(function(e,t,r){return f.matchStart=i,f.groupIndex=r,i=!1,n(e,t,f)}),(function(e,t,n){s&&d++,r(e,{match:a,matchStart:s,count:d,groupIndex:n,groupStart:t}),s=!1})),!h.abort););o(d)}))}},{key:"wrapMatchesAcrossElements",value:function(e,t,n,r,o){var a,i,s=this,c=0===t?0:t+1,u={abort:!1},l={execution:u},h=0;this.getTextNodesAcrossElements((function(t){for(;null!==(a=e.exec(t.value))&&""!==a[c];){l.match=a,i=!0;var f=a.index;if(0!==c)for(var d=1;d<c;d++)f+=a[d].length;var p=f+a[c].length;if(s.wrapRangeInMappedTextNode(t,f,p,(function(e){return l.matchStart=i,l.offset=e.startOffset,i=!1,n(a[c],e.node,l)}),(function(e,t){t&&h++,r(e,{match:a,matchStart:t,count:h})})),u.abort)break}o(h)}))}},{key:"wrapRangeFromIndex",value:function(e,t,n,r){var o=this,a=0;this.getTextNodes((function(i){var s=i.value.length;e.forEach((function(e,r){var c=o.checkWhitespaceRanges(e,s,i.value),u=c.start,l=c.end;c.valid&&o.wrapRangeInMappedTextNode(i,u,l,(function(n){return t(n.node,e,i.value.substring(u,l),r)}),(function(t,r){r&&a++,n(t,e,{matchStart:r,count:a})}))})),r(a)}))}},{key:"unwrapMatches",value:function(e){for(var t=e.parentNode,n=document.createDocumentFragment();e.firstChild;)n.appendChild(e.removeChild(e.firstChild));t.replaceChild(n,e),this.ie?this.normalizeTextNode(t):t.normalize()}},{key:"normalizeTextNode",value:function(e){if(e){if(3===e.nodeType)for(;e.nextSibling&&3===e.nextSibling.nodeType;)e.nodeValue+=e.nextSibling.nodeValue,e.parentNode.removeChild(e.nextSibling);else this.normalizeTextNode(e.firstChild);this.normalizeTextNode(e.nextSibling)}}},{key:"markRegExp",value:function(e,t){var n=this;this.opt=this.checkOption(t);var r=0,o=this.getMethodName(t);if(this.opt.acrossElements&&!e.global&&!e.sticky){var a=e.toString().split("/");e=new RegExp(e.source,"g"+a[a.length-1]),this.log("RegExp is recompiled with g flag because it must have g flag")}this.log('Searching with expression "'.concat(e,'"')),this[o](e,this.opt.ignoreGroups,(function(e,t,o){return n.opt.filter(t,e,r,o)}),(function(e,t){r++,n.opt.each(e,t)}),(function(t){0===t&&n.opt.noMatch(e),n.opt.done(r,t)}))}},{key:"mark",value:function(e,t){var n=this;if(this.opt=this.checkOption(t),this.opt.combinePatterns)this.markCombinePatterns(e,t);else{var r=0,o=0,a=0,s=this.opt.acrossElements?"wrapMatchesAcrossElements":"wrapMatches",c={},u=this.getSeparatedKeywords("string"==typeof e?[e]:e),l=u.keywords,h=u.length;0===h?this.opt.done(0,0,c):function e(t){var u=new i(n.opt).create(t),f=0;n.log('Searching with expression "'.concat(u,'"')),n[s](u,1,(function(e,r,a){return n.opt.filter(r,t,o,f,a)}),(function(e,t){f++,o++,n.opt.each(e,t)}),(function(i){a+=i,0===i&&n.opt.noMatch(t),c[t]=i,++r<h?e(l[r]):n.opt.done(o,a,c)}))}(l[r])}}},{key:"markCombinePatterns",value:function(e,t){var n=this;this.opt=this.checkOption(t);var r,o=0,a=0,i=0,s=[],c=[],u=this.opt.acrossElements,l=u?"wrapMatchesAcrossElements":"wrapMatches",h="gm".concat(this.opt.caseSensitive?"":"i"),f={},d=this.getSeparatedKeywords("string"==typeof e?[e]:e);if(0===d.length)this.opt.done(0,0,f);else{d.keywords.forEach((function(e){f[e]=0}));var p=this.getPatterns(d.keywords);c=p.terms,function e(t){var d=new RegExp(t,h),p=c[o];n.log('Searching with expression "'.concat(d,'"')),n[l](d,1,(function(e,t,o){return u?o.matchStart&&(r=n.getCurrentTerm(o.match,p)):r=n.getCurrentTerm(o.match,p),n.opt.filter(t,r,a,f[r],o)}),(function(e,t){a++,u?t.matchStart&&(f[r]+=1):f[r]+=1,n.opt.each(e,t)}),(function(t){i+=t;var r=p.filter((function(e){return 0===f[e]}));r.length&&n.opt.noMatch(r),++o<s.length?e(s[o]):n.opt.done(a,i,f)}))}((s=p.patterns)[o])}}},{key:"getCurrentTerm",value:function(e,t){for(var n=e.length;--n>2;)if(e[n])return t[n-3];return" "}},{key:"getPatterns",value:function(e){var t=new i(this.opt),n=t.create(e[0],!0),r=[],o=[],a=10;"number"==typeof this.opt.combinePatterns&&(this.opt.combinePatterns===1/0?a=Math.pow(2,31):this.isNumeric(this.opt.combinePatterns)&&(a=parseInt(this.opt.combinePatterns)));for(var s=Math.ceil(e.length/a),c=0;c<s;c++){for(var u=n.lookbehind+"(",l=[],h=Math.min(c*a+a,e.length),f=c*a;f<h;f++)l.push(e[f]);u+=t.createCombinePattern(l,!0).pattern,r.push(u+")"+n.lookahead),o.push(l)}return{patterns:r,terms:o}}},{key:"getMethodName",value:function(e){if(e){if(e.acrossElements)return e.separateGroups?"wrapGroupsAcrossElements":"wrapMatchesAcrossElements";if(e.separateGroups)return"wrapSeparateGroups"}return"wrapMatches"}},{key:"markRanges",value:function(e,t){var n=this;this.opt=t;var r=0,o=this.checkRanges(e);o&&o.length?(this.log("Starting to mark with the following ranges: "+JSON.stringify(o)),this.wrapRangeFromIndex(o,(function(e,t,r,o){return n.opt.filter(e,t,r,o)}),(function(e,t,o){r++,n.opt.each(e,t,o)}),(function(e){n.opt.done(r,e)}))):this.opt.done(0,0)}},{key:"unmark",value:function(e){var t=this;this.opt=e;var n=(this.opt.element?this.opt.element:"mark")+"[data-markjs]";this.opt.className&&(n+=".".concat(this.opt.className)),this.log('Removal selector "'.concat(n,'"')),this.iterator.forEachNode(NodeFilter.SHOW_ELEMENT,(function(e){t.unwrapMatches(e)}),(function(e){return a.matches(e,n)&&!t.matchesExclude(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),this.opt.done)}}]),n}();return function(e){var t=this,n=new s(e);return this.mark=function(e,r){return n.mark(e,r),t},this.markRegExp=function(e,r){return n.markRegExp(e,r),t},this.markRanges=function(e,r){return n.markRanges(e,r),t},this.unmark=function(e){return n.unmark(e),t},this.getVersion=function(){return n.version},this}}));
