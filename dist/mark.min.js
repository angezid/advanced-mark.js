/*!***************************************************
* advanced-mark.js v2.4.0
* https://github.com/angezid/advanced-mark.js#readme
* MIT licensed
* Copyright (c) 2022–2023, angezid
* Based on 'mark.js', license https://git.io/vwTVl
*****************************************************/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Mark=e()}(this,(function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(o=r.key,a=void 0,"symbol"==typeof(a=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"))?a:String(a)),r)}var o,a}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(){return o=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},o.apply(this,arguments)}var a=function(){function t(n,r){e(this,t),this.ctx=n,this.opt=r,this.attrName="data-markjsListener"}return r(t,[{key:"getContexts",value:function(){var t,e=!1;this.ctx?this.opt.window.NodeList.prototype.isPrototypeOf(this.ctx)?t=this.ctx:Array.isArray(this.ctx)?(t=this.ctx,e=!0):t="string"==typeof this.ctx?this.opt.window.document.querySelectorAll(this.ctx):[this.ctx]:t=[];var n=[];return t.forEach((function(t){-1!==n.indexOf(t)||n.some((function(e){return e.contains(t)}))||n.push(t)})),e&&n.sort((function(t,e){return(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING)>0?-1:1})),n}},{key:"getIframeContents",value:function(t,e,n){try{var r=t.contentWindow.document;r&&(t.setAttribute(this.attrName,"completed"),e({iframe:t,context:r}))}catch(e){t.setAttribute(this.attrName,"error"),n({iframe:t,error:e})}}},{key:"isIframeBlank",value:function(t){var e="about:blank",n=t.getAttribute("src").trim();return t.contentWindow.location.href===e&&n!==e&&n}},{key:"observeIframeLoad",value:function(t,e,n){var r=this;if(!t.hasAttribute(this.attrName)){var o=null,a=function a(){clearTimeout(o),t.removeEventListener("load",a),r.getIframeContents(t,e,n)};t.addEventListener("load",a),t.setAttribute(this.attrName,!0),o=setTimeout(a,this.opt.iframesTimeout)}}},{key:"onIframeReady",value:function(t,e,n){try{"complete"===t.contentWindow.document.readyState?this.isIframeBlank(t)?this.observeIframeLoad(t,e,n):this.getIframeContents(t,e,n):this.observeIframeLoad(t,e,n)}catch(t){n(t)}}},{key:"waitForAllIframes",value:function(e,n){var r=this,o=0,a=[],i=[],s=!1,c=setTimeout((function(){s=!0,n()}),this.opt.iframesTimeout),u=function(){clearTimeout(c),s||n()},h=function(){o===a.filter((function(t){return!r.hasAttributeValue(t,r.attrName,"error")})).length&&u()};!function e(n){n.iframe&&"about:blank"===n.context.location.href||(i=[],n.context.querySelectorAll(n.iframe?"body iframe":"iframe").forEach((function(e){t.matches(e,r.opt.exclude)||(a.push(e),e.hasAttribute(r.attrName)||i.push(e))})),n.iframe||i.length)?i.length?i.forEach((function(t){r.onIframeReady(t,(function(t){o++,e(t)}),(function(t){r.opt.debug&&console.log(t.error),h()}))})):h():u()}({context:e})}},{key:"createIterator",value:function(t,e,n){return this.opt.window.document.createNodeIterator(t,e,n,!1)}},{key:"addRemoveStyle",value:function(t,e,n){if(n){if(e&&t.firstChild&&!t.querySelector("style[data-markjs]")){var r=this.opt.window.document.createElement("style");r.setAttribute("data-markjs","true"),r.textContent=e,t.insertBefore(r,t.firstChild)}}else{var o=t.querySelector("style[data-markjs]");o&&t.removeChild(o)}}},{key:"hasAttributeValue",value:function(t,e,n){return t.hasAttribute(e)&&t.getAttribute(e)===n}},{key:"iterateThroughNodes",value:function(e,n,r,o,a){var i=this,s=this.opt.window.NodeFilter,c=this.opt.shadowDOM,u=this.opt.iframes;if(u||c){var h=0!=(n&s.SHOW_ELEMENT),l=0!=(n&s.SHOW_TEXT);l&&(n=s.SHOW_ELEMENT|s.SHOW_TEXT);!function e(a){for(var s=i.createIterator(a,n);a=s.nextNode();)1===a.nodeType?(h&&r(a)&&o(a),u&&"iframe"===a.nodeName.toLowerCase()&&!t.matches(a,i.opt.exclude)&&i.hasAttributeValue(a,i.attrName,"completed")&&i.getIframeContents(a,(function(t){e(t.context)}),(function(){})),c&&a.shadowRoot&&"open"===a.shadowRoot.mode&&(i.addRemoveStyle(a.shadowRoot,c.style,l),e(a.shadowRoot))):l&&3===a.nodeType&&r(a)&&o(a)}(e)}else for(var f,p=this.createIterator(e,n,(function(t){return r(t)?s.FILTER_ACCEPT:s.FILTER_REJECT}));f=p.nextNode();)o(f);a()}},{key:"forEachNode",value:function(t,e,n){var r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},a=this.getContexts(),i=a.length;i||o(),a.forEach((function(a){i--;var s=function(){r.iterateThroughNodes(a,t,n,e,(function(){i<=0&&o()}))};r.opt.iframes?r.waitForAllIframes(a,s):s()}))}}],[{key:"matches",value:function(t,e){if(!e||!e.length)return!1;var n="string"==typeof e?[e]:e,r=t.matches||t.matchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector;return r&&n.some((function(e){return r.call(t,e)}))}}]),t}(),i=function(){function t(n){e(this,t),this.opt=o({},{diacritics:!0,synonyms:{},accuracy:"partially",caseSensitive:!1,ignoreJoiners:!1,ignorePunctuation:[],wildcards:"disabled"},n)}return r(t,[{key:"chars",get:function(){var t=this;return this._chars||(this._chars=[],["aàáảãạăằắẳẵặâầấẩẫậäåāą","cçćč","dđď","eèéẻẽẹêềếểễệëěēę","iìíỉĩịîïī","lł","nñňń","oòóỏõọôồốổỗộơởỡớờợöøōő","rř","sšśșş","tťțţ","uùúủũụưừứửữựûüůūű","yýỳỷỹỵÿ","zžżź"].forEach((function(e){t._chars.push(e,e.toUpperCase())}))),this._chars}},{key:"create",value:function(t,e){var n="g"+(this.opt.caseSensitive?"":"i");t=this.checkWildcardsEscape(t),t=this.createSynonyms(t,n);var r=this.getJoinersPunctuation();r&&(t=this.setupIgnoreJoiners(t)),this.opt.diacritics&&(t=this.createDiacritics(t)),t=t.replace(/\s+/g,"[\\s]+"),r&&(t=this.createJoiners(t,r)),"disabled"!==this.opt.wildcards&&(t=this.createWildcards(t));var o=this.createAccuracy(t);return e?o:new RegExp("".concat(o.lookbehind,"(").concat(o.pattern,")").concat(o.lookahead),n)}},{key:"createCombinePattern",value:function(t,e){var n=this;if(!Array.isArray(t)||!t.length)return null;var r=e?"(":"(?:",o=this.create(t[0],!0);return o.pattern=this.distinct(t.map((function(t){return"".concat(r).concat(n.create(t,!0).pattern,")")}))).join("|"),o}},{key:"sortByLength",value:function(t){return t.sort((function(t,e){return t.length===e.length?t>e?1:-1:e.length-t.length}))}},{key:"escape",value:function(t){return t.replace(/[[\]/{}()*+?.\\^$|]/g,"\\$&")}},{key:"preprocess",value:function(t){return t&&t.length?this.distinct("string"==typeof t?t.split(""):t).join("").replace(/[-^\]\\]/g,"\\$&"):""}},{key:"distinct",value:function(t){var e=[];return t.forEach((function(t){t.trim()&&-1===e.indexOf(t)&&e.push(t)})),e}},{key:"createSynonyms",value:function(t,e){var n=this,r=this.opt.synonyms;if(!Object.keys(r).length)return t;for(var o in r)if(r.hasOwnProperty(o)){var a=Array.isArray(r[o])?r[o]:[r[o]];if(a.unshift(o),(a=this.sortByLength(this.distinct(a)).map((function(t){return n.checkWildcardsEscape(t)}))).length>1){var i=a.map((function(t){return n.escape(t)})).join("|");t=t.replace(new RegExp(i,e),"(?:".concat(a.join("|"),")"))}}return t}},{key:"checkWildcardsEscape",value:function(t){return"disabled"!==this.opt.wildcards&&(t=t.replace(/(\\.)+|[?*]/g,(function(t,e){return e?t:"?"===t?"":""})).replace(/\\+(?=[?*\x01\x02])/g,(function(t){return t.slice(1)}))),this.escape(t)}},{key:"createWildcards",value:function(t){var e="withSpaces"===this.opt.wildcards,n=this.opt.blockElementsBoundary,r="[^".concat(e&&n?"":"","]*?");return t.replace(/\x01/g,e?"[^]?":"\\S?").replace(/\x02/g,e?r:"\\S*")}},{key:"setupIgnoreJoiners",value:function(t){return t.replace(/(\(\?:|\|)|\\?(?:[\uD800-\uDBFF][\uDC00-\uDFFF]|.)(?=([|)]|$)|.)/g,(function(t,e,n){return e||void 0!==n?t:t+"\0"}))}},{key:"createJoiners",value:function(t,e){return t.split(/\x00+/).join("[".concat(e,"]*"))}},{key:"getJoinersPunctuation",value:function(){var t=this.preprocess(this.opt.ignorePunctuation),e=t||"";return this.opt.ignoreJoiners&&(e+="\\u00ad\\u200b\\u200c\\u200d"),e}},{key:"createDiacritics",value:function(t){var e=this,n=this.chars;return t.split("").map((function(t){for(var r=0;r<n.length;r+=2){var o=-1!==n[r].indexOf(t);if(e.opt.caseSensitive){if(o)return"["+n[r]+"]";if(-1!==n[r+1].indexOf(t))return"["+n[r+1]+"]"}else if(o||-1!==n[r+1].indexOf(t))return"["+n[r]+n[r+1]+"]"}return t})).join("")}},{key:"createAccuracy",value:function(t){var e,n=this.opt.accuracy,r="()",o=t,a="";if("string"!=typeof n&&(e=this.preprocess(n.limiters),n=n.value),"exactly"===n){var i=e?"[\\s"+e+"]":"\\s";r="(^|".concat(i,")"),a="(?=$|".concat(i,")")}else{var s=e||"!\"#$%&'()*+,\\-./:;<=>?@[\\]\\\\^_`{|}~¡¿",c="[^\\s".concat(s,"]*");"complementary"===n?o=c+t+c:"startsWith"===n&&(r="(^|[\\s".concat(s,"])"),o=t.replace(/\[\\s\]\+/g,c+"$&")+c)}return{lookbehind:r,pattern:o,lookahead:a}}}]),t}(),s=function(){function n(t){e(this,n),this.ctx=t,this.nodeNames=["script","style","title","head","html"]}return r(n,[{key:"opt",get:function(){return this._opt},set:function(t){if(!(t&&t.window&&t.window.document)&&"undefined"==typeof window)throw new Error("Mark.js: please provide a window object as an option.");var e=t&&t.window||window;this._opt=o({},{window:e,element:"",className:"",exclude:[],iframes:!1,iframesTimeout:5e3,separateWordSearch:!0,acrossElements:!1,ignoreGroups:0,each:function(){},noMatch:function(){},filter:function(){return!0},done:function(){},debug:!1,log:e.console},t),this._opt.element||(this._opt.element="mark")}},{key:"empty",get:function(){return this._empty||(this._empty=this.opt.window.document.createTextNode("")),this._empty}},{key:"iterator",get:function(){return new a(this.ctx,this.opt)}},{key:"log",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"debug";if(this.opt.debug){var r=this.opt.log;"object"===t(r)&&"function"==typeof r[n]&&r[n]("mark.js: ".concat(e))}}},{key:"report",value:function(t){var e=this;t.forEach((function(t){e.log("".concat(t.text," ").concat(JSON.stringify(t.obj)),t.level||"debug"),t.skip||e.opt.noMatch(t.obj)}))}},{key:"checkOption",value:function(t,e){this.opt=t;var n=this.cacheDict,r=!0;n&&(!e&&this.opt.cacheTextNodes&&(this.opt.acrossElements?"across"===n.type&&(r=!1):"every"===n.type&&(r=!1)),r&&(this.cacheDict=null))}},{key:"getSeachTerms",value:function(t){var e="string"==typeof t?[t]:t,n=this.opt.separateWordSearch,r=[],o=function(t){t.split(/ +/).forEach((function(t){return a(t)}))},a=function(t){t.trim()&&-1===r.indexOf(t)&&r.push(t)};return e.forEach((function(t){n?"preserveTerms"===n?t.split(/"("*[^"]+"*)"/).forEach((function(t,e){e%2>0?a(t):o(t)})):o(t):a(t)})),r.sort((function(t,e){return e.length-t.length})),r}},{key:"isNumeric",value:function(t){return Number(parseFloat(t))==t}},{key:"checkRanges",value:function(t,e,n,r){var o=this,a="error",i=t.filter((function(t){return!!(o.isNumeric(t.start)&&o.isNumeric(t.length)&&(t.start=parseInt(t.start),t.length=parseInt(t.length),t.start>=n&&t.start<r&&t.length>0))||(e.push({text:"Invalid range: ",obj:t,level:a}),!1)})).sort((function(t,e){return t.start-e.start}));if(this.opt.wrapAllRanges)return i;var s,c=0;return i.filter((function(t){return s=t.start+t.length,t.start>=c?(c=s,!0):(e.push({text:(s<c?"Nest":"Overlapp")+"ing range: ",obj:t,level:a}),!1)}))}},{key:"setType",value:function(t,e){var n=Array.isArray(e.tagNames)&&e.tagNames.length;if(n&&e.tagNames.forEach((function(e){return t[e.toLowerCase()]=2})),!n||e.extend)for(var r in t)t[r]=2;t.br=3}},{key:"getTextNodesAcross",value:function(t){var e=this;if(this.opt.cacheTextNodes&&this.cacheDict)return this.cacheDict.lastIndex=0,this.cacheDict.lastTextIndex=0,void t(this.cacheDict);var n,r,o,a={div:1,p:1,li:1,td:1,tr:1,th:1,ul:1,ol:1,dd:1,dl:1,dt:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,blockquote:1,figcaption:1,figure:1,pre:1,table:1,thead:1,tbody:1,tfoot:1,input:1,img:1,nav:1,details:1,label:1,form:1,select:1,menu:1,br:3,menuitem:1,main:1,section:1,article:1,aside:1,picture:1,output:1,button:1,header:1,footer:1,address:1,area:1,canvas:1,map:1,fieldset:1,textarea:1,track:1,video:1,audio:1,body:1,iframe:1,meter:1,object:1,svg:1},i=[],s=this.opt.blockElementsBoundary,c=s?2:1,u="";s&&(this.setType(a,s),s.char&&(u=s.char.charAt(0)));var h={text:"",regex:/\s/,tags:a,boundary:s,startOffset:0,str:"",ch:u};this.iterator.forEachNode(this.opt.window.NodeFilter.SHOW_ELEMENT|this.opt.window.NodeFilter.SHOW_TEXT,(function(t){o&&i.push(e.getNodeInfo(o,t,r,h)),r=null,o=t}),(function(t){return 1===t.nodeType?(3===(n=a[t.nodeName.toLowerCase()])&&(h.str+="\n"),r&&n!==c||(r=n),!1):!e.excludeElements(t.parentNode)}),(function(){o&&i.push(e.getNodeInfo(o,o,r,h)),t(e.createDict(h.text,i,"across"))}))}},{key:"getNodeInfo",value:function(t,e,n,r){var o=r.text.length,a=r.startOffset,i=r.ch,s=0,c=r.str,u=t.textContent;if(t!==e){var h=r.regex.test(e.textContent[0]),l=h&&r.regex.test(u[u.length-1]);if(r.boundary||!l){var f=n;if(!n)for(var p=t.parentNode;p;){if(n=r.tags[p.nodeName.toLowerCase()]){f=!(p===e.parentNode||p.contains(e));break}p=p.parentNode}f&&(l?2===n&&(c+=l?i:h?" "+i:i+" "):c+=1===n?" ":2===n?" "+i+" ":"")}}return c&&(u+=c,s=c.length,r.startOffset-=s,r.str=""),r.text+=u,this.createInfo(t,o,r.text.length-s,s,a)}},{key:"getTextNodes",value:function(t){var e=this;if(this.opt.cacheTextNodes&&this.cacheDict)t(this.cacheDict);else{var n,r=[],o=/\n/g,a=[0],i=this.opt.markLines,s="",c=0,u=this.opt.window.NodeFilter.SHOW_TEXT;u=i?this.opt.window.NodeFilter.SHOW_ELEMENT|u:u,this.iterator.forEachNode(u,(function(t){if(i)for(;null!==(n=o.exec(t.textContent));)a.push(c+n.index);s+=t.textContent,r.push({start:c,end:c=s.length,offset:0,node:t})}),(function(t){return i&&1===t.nodeType?("br"===t.tagName.toLowerCase()&&a.push(c),!1):!e.excludeElements(t.parentNode)}),(function(){var n=e.createDict(s,r,"every");i&&(a.push(c),n.newLines=a),t(n)}))}}},{key:"createDict",value:function(t,e,n){var r={text:t,nodes:e,lastIndex:0,lastTextIndex:0};return this.opt.cacheTextNodes&&(this.cacheDict=r,this.cacheDict.type=n),r}},{key:"excludeElements",value:function(t){return-1!==this.nodeNames.indexOf(t.nodeName.toLowerCase())||a.matches(t,this.opt.exclude)}},{key:"wrapRangeInsert",value:function(t,e,n,r,o,a){var i=r===e.node.textContent.length,s=e.end,c=1,u=r,h=e.node;0!==n?(h=h.splitText(n),u=r-n,c=i?2:3):i&&(c=0);var l=i?this.empty:h.splitText(u),f=this.wrapTextNode(h);if(0===c)return e.node=f.childNodes[0],{mark:f,nodeInfo:this.createInfo(l,s,s,e.offset,0),increment:0};var p=this.createInfo(f.childNodes[0],1===c?e.start:o,e.start+r,0,e.startOffset),d=this.createInfo(l,2===c?s:e.start+r,s,e.offset,e.startOffset);return 1===c?t.nodes.splice(a,1,p,d):(2===c?t.nodes.splice(a+1,0,p):t.nodes.splice(a+1,0,p,d),e.end=o,e.offset=0),{mark:f,nodeInfo:d,increment:c<3?1:2}}},{key:"createInfo",value:function(t,e,n,r,o){return{node:t,start:e,end:n,offset:r,startOffset:o}}},{key:"wrapRange",value:function(t,e,n,r){var o,a=n===t.textContent.length,i=n;return 0!==e&&(t=t.splitText(e),i=n-e),o=a?this.empty:t.splitText(i),r(this.wrapTextNode(t)),o}},{key:"wrapTextNode",value:function(t){var e=this.opt.window.document.createElement(this.opt.element);return e.setAttribute("data-markjs","true"),this.opt.className&&e.setAttribute("class",this.opt.className),e.textContent=t.textContent,t.parentNode.replaceChild(e,t),e}},{key:"wrapRangeAcross",value:function(t,e,n,r,o){var a=t.lastIndex,i=!0,s=this.opt.wrapAllRanges||this.opt.cacheTextNodes;if(s)for(;a>0&&t.nodes[a].start>e;)a--;else if(e<t.lastTextIndex)return;for(;a<t.nodes.length;a++)if(a+1===t.nodes.length||t.nodes[a+1].start>e){var c=t.nodes[a];if(!r(c))break;var u=e-c.start,h=(n>c.end?c.end:n)-c.start;if(u>=0&&h>u){if(s){var l=this.wrapRangeInsert(t,c,u,h,e,a);c=l.nodeInfo,o(l.mark,i)}else c.node=this.wrapRange(c.node,u,h,(function(t){o(t,i)})),c.start+=h,t.lastTextIndex=c.start;i=!1}if(!(n>c.end))break;e=c.end+c.offset}t.lastIndex=a}},{key:"wrapGroups",value:function(t,e,n,r,o){for(var a,i,s,c=e.index,u=-1,h=!1;++u<n.groups.length;)(i=e[a=n.groups[u]])&&-1!==(s=t.textContent.indexOf(i,c))&&(r(t,i,a)?(t=this.wrapRange(t,s,s+i.length,(function(t){o(t,a)})),c=0,h=!0):c=s+i.length);return h&&(n.regex.lastIndex=0),t}},{key:"wrapGroupsAcross",value:function(t,e,n,r,o){var a,i,s,c=this,u=0,h=0,l=e.index,f=e[0],p=function(e,n){c.wrapRangeAcross(t,e,n,(function(t){return r(t,f,h)}),(function(t,e){o(t,e,h)}))};this.opt.wrapAllRanges&&p(l,l+f.length);for(var d=0;d<n.groups.length;d++)(a=e[h=n.groups[d]])&&-1!==(i=f.indexOf(a,u))&&(p(l+i,l+(s=i+a.length)),u=s)}},{key:"wrapGroupsDFlag",value:function(t,e,n,r,o){for(var a,i,s=0,c=0,u=0,h=!1,l=0;++u<e.length;)(a=e[u])&&(i=e.indices[u][0])>=s&&(l=e.indices[u][1],r(t,a,u)&&(t=this.wrapRange(t,i-c,l-c,(function(t){o(t,u)})),l>s&&(s=l),c=l,h=!0));return h?n.regex.lastIndex=0:0===e[0].length&&this.setLastIndex(n.regex,l),t}},{key:"wrapGroupsDFlagAcross",value:function(t,e,n,r,o){for(var a,i,s,c=0,u=0,h=0;++u<e.length;)(a=e[u])&&(i=e.indices[u][0],(this.opt.wrapAllRanges||i>=c)&&(h=e.indices[u][1],s=!1,this.wrapRangeAcross(t,i,h,(function(t){return r(t,a,u)}),(function(t,e){s=!0,o(t,e,u)})),s&&h>c&&(c=h)));0===e[0].length&&this.setLastIndex(n.regex,h)}},{key:"setLastIndex",value:function(t,e){var n=t.lastIndex;t.lastIndex=e>n?e:e>0?n+1:1/0}},{key:"collectRegexGroupIndexes",value:function(t){for(var e=[],n=[],r=-1,o=1,a=0,i=!1,s=t.source,c=/^\(\?<(?![=!])|^\((?!\?)/;++r<s.length;)switch(s[r]){case"(":i||(c.test(s.substring(r))?(n.push(1),0===a&&e.push(o),a++,o++):n.push(0));break;case")":i||1!==n.pop()||a--;break;case"\\":r++;break;case"[":i=!0;break;case"]":i=!1}return e}},{key:"wrapSeparateGroups",value:function(t,e,n,r,o){var a,i,s,c,u=this,h=t.hasIndices,l=h?"wrapGroupsDFlag":"wrapGroups",f={regex:t,groups:h?{}:this.collectRegexGroupIndexes(t)},p={abort:!1},d={execution:p},g=0;this.getTextNodes((function(e){e.nodes.every((function(e){for(a=e.node,d.offset=e.start;null!==(i=t.exec(a.textContent))&&(h||""!==i[0])&&(d.match=i,s=c=!0,a=u[l](a,i,f,(function(t,e,r){return d.matchStart=s,d.groupIndex=r,s=!1,n(t,e,d)}),(function(t,e){c&&g++,r(t,{match:i,matchStart:c,count:g,groupIndex:e}),c=!1})),!p.abort););return!p.abort})),o(g)}))}},{key:"wrapSeparateGroupsAcross",value:function(t,e,n,r,o){var a,i,s,c=this,u=t.hasIndices,h=u?"wrapGroupsDFlagAcross":"wrapGroupsAcross",l={regex:t,groups:u?{}:this.collectRegexGroupIndexes(t)},f={abort:!1},p={execution:f},d=0;this.getTextNodesAcross((function(e){for(;null!==(a=t.exec(e.text))&&(u||""!==a[0])&&(p.match=a,i=s=!0,c[h](e,a,l,(function(t,e,r){return p.matchStart=i,p.groupIndex=r,p.offset=t.startOffset,i=!1,n(t.node,e,p)}),(function(t,e,n){s&&d++,r(t,{match:a,matchStart:s,count:d,groupIndex:n,groupStart:e}),s=!1})),!f.abort););o(d)}))}},{key:"wrapMatches",value:function(t,e,n,r,o){var a,i,s,c,u=this,h=0===e?0:e+1,l={abort:!1},f={execution:l},p=0;this.getTextNodes((function(e){for(var d=0;d<e.nodes.length;d++){for(a=e.nodes[d],i=a.node;null!==(s=t.exec(i.textContent))&&""!==(c=s[h]);)if(f.match=s,f.offset=a.start,n(i,c,f)&&c){for(var g=0,m=s.index;++g<h;)s[g]&&(m+=s[g].length);var v=m+c.length;if(u.opt.cacheTextNodes){var y=u.wrapRangeInsert(e,a,m,v,a.start+m,d);if(r(y.mark,{match:s,count:++p}),0===y.increment)break;d+=y.increment,a=y.nodeInfo,i=a.node}else i=u.wrapRange(i,m,v,(function(t){r(t,{match:s,count:++p})}));if(t.lastIndex=0,l.abort)break}if(l.abort)break}o(p)}))}},{key:"wrapMatchesAcross",value:function(t,e,n,r,o){var a,i,s,c=this,u=0===e?0:e+1,h={abort:!1},l={execution:h},f=0;this.getTextNodesAcross((function(e){for(;null!==(a=t.exec(e.text))&&""!==(i=a[u]);){l.match=a,s=!0;for(var p=0,d=a.index;++p<u;)a[p]&&(d+=a[p].length);if(c.wrapRangeAcross(e,d,d+(i?i.length:0),(function(t){return l.matchStart=s,l.offset=t.startOffset,s=!1,n(t.node,i,l)}),(function(t,e){e&&f++,r(t,{match:a,matchStart:e,count:f})})),h.abort)break}o(f)}))}},{key:"wrapRanges",value:function(t,e,n,r){var o=this,a=this.opt.markLines,i=[],s=[],c="warn",u=0;this.getTextNodes((function(h){var l=a?h.newLines.length:h.text.length,f=o.checkRanges(t,i,a?1:0,l);f.forEach((function(t,r){var f=t.start,p=f+t.length;p>l&&(i.push({text:"Range was limited to: ".concat(l),obj:t,skip:!0,level:c}),p=l),a&&(f=h.newLines[f-1],"\n"===h.text[f]&&f++,p=h.newLines[p-1]);var d=h.text.substring(f,p);d.trim()?o.wrapRangeAcross(h,f,p,(function(n){return e(n.node,t,d,r)}),(function(e,r){r&&u++,n(e,t,{matchStart:r,count:u})})):(i.push({text:"Skipping whitespace only range: ",obj:t,level:c}),s.push(t))})),o.log("Valid ranges: ".concat(JSON.stringify(f.filter((function(t){return-1===s.indexOf(t)}))))),r(u,i)}))}},{key:"unwrapMatches",value:function(t){var e=t.parentNode,n=t.firstChild;if(1===t.childNodes.length)if(3===n.nodeType){var r=t.previousSibling,o=t.nextSibling;if(r&&3===r.nodeType)o&&3===o.nodeType?(r.nodeValue+=n.nodeValue+o.nodeValue,e.removeChild(o)):r.nodeValue+=n.nodeValue;else{if(!o||3!==o.nodeType)return void e.replaceChild(t.firstChild,t);o.nodeValue=n.nodeValue+o.nodeValue}e.removeChild(t)}else e.replaceChild(t.firstChild,t);else{if(n){for(var a=this.opt.window.document.createDocumentFragment();t.firstChild;)a.appendChild(t.removeChild(t.firstChild));e.replaceChild(a,t)}else e.removeChild(t);e.normalize()}}},{key:"markRegExp",value:function(t,e){var n=this;this.checkOption(e);var r=0,o=0,a=this.opt.separateGroups?"wrapSeparateGroups":"wrapMatches";if(this.opt.acrossElements&&(a=this.opt.separateGroups?"wrapSeparateGroupsAcross":"wrapMatchesAcross",!t.global&&!t.sticky)){var i=t.toString().split("/");t=new RegExp(t.source,"g"+i[i.length-1]),this.log("RegExp is recompiled because it must have g flag")}this.log('RegExp "'.concat(t,'"')),this[a](t,this.opt.ignoreGroups,(function(t,e,r){return n.opt.filter(t,e,o,r)}),(function(t,e){o=e.count,r++,n.opt.each(t,e)}),(function(e){0===e&&n.opt.noMatch(t),n.opt.done(r,e)}))}},{key:"mark",value:function(t,e){var n=this;if(this.checkOption(e),this.opt.combinePatterns)this.markCombinePatterns(t);else{var r=0,o=0,a=0,s=0,c=new i(this.opt),u=this.opt.acrossElements?"wrapMatchesAcross":"wrapMatches",h={},l=this.getSeachTerms(t);l.length?function t(e){var i=c.create(e),f=0;n.log('RegExp "'.concat(i,'"')),n[u](i,1,(function(t,r,o){return a=s+f,n.opt.filter(t,e,a,f,o)}),(function(t,e){f=e.count,o++,n.opt.each(t,e)}),(function(a){s+=a,0===a&&n.opt.noMatch(e),h[e]=a,++r<l.length?t(l[r]):n.opt.done(o,s,h)}))}(l[r]):this.opt.done(0,0,h)}}},{key:"markCombinePatterns",value:function(t){var e,n,r=this,o=0,a=0,i=0,s=[],c=[],u=this.opt.acrossElements,h=u?"wrapMatchesAcross":"wrapMatches",l="g".concat(this.opt.caseSensitive?"":"i"),f={},p=this.getSeachTerms(t);if(p.length){p.forEach((function(t){return f[t]=0}));var d=this.getPatterns(p);c=d.termsParts,function t(p){var d=new RegExp(p,l),g=c[o];r.log('RegExp "'.concat(d,'"')),r[h](d,1,(function(t,o,a){return u&&!a.matchStart||(e=r.getCurrentTerm(a.match,g)),n=f[e],r.opt.filter(t,e,i+n,n,a)}),(function(t,n){a++,u&&!n.matchStart||(f[e]+=1),r.opt.each(t,n)}),(function(e){i+=e;var n=g.filter((function(t){return 0===f[t]}));n.length&&r.opt.noMatch(n),++o<s.length?t(s[o]):r.opt.done(a,i,f)}))}((s=d.patterns)[o])}else this.opt.done(0,0,f)}},{key:"getCurrentTerm",value:function(t,e){for(var n=t.length;--n>2;)if(t[n])return e[n-3];return" "}},{key:"getPatterns",value:function(t){var e,n=new i(this.opt),r=n.create(t[0],!0),o=this.opt.combinePatterns,a=[],s=[],c=10;o===1/0?c=Math.pow(2,31):this.isNumeric(o)&&(e=parseInt(o))>0&&(c=e);for(var u=Math.ceil(t.length/c),h=0;h<u;h++){for(var l=[],f=Math.min(h*c+c,t.length),p=h*c;p<f;p++)l.push(t[p]);var d="".concat(r.lookbehind,"(").concat(n.createCombinePattern(l,!0).pattern,")").concat(r.lookahead);a.push(d),s.push(l)}return{patterns:a,termsParts:s}}},{key:"markRanges",value:function(t,e){var n=this;if(this.checkOption(e,!0),Array.isArray(t)&&t.some((function(t){return"[object Object]"===String(t)}))){var r=0;this.wrapRanges(t,(function(t,e,r,o){return n.opt.filter(t,e,r,o)}),(function(t,e,o){r++,n.opt.each(t,e,o)}),(function(t,e){n.report(e),n.opt.done(r,t)}))}else this.report([{text:"markRanges() accept an array of objects: ",obj:t,level:"error"}]),this.opt.done(0,0)}},{key:"unmark",value:function(t){var e=this;this.checkOption(t,!0);var n=this.opt.element+"[data-markjs]";this.opt.className&&(n+=".".concat(this.opt.className)),this.log('Removal selector "'.concat(n,'"')),this.iterator.forEachNode(this.opt.window.NodeFilter.SHOW_ELEMENT,(function(t){e.unwrapMatches(t)}),(function(t){return a.matches(t,n)&&!e.excludeElements(t)}),this.opt.done)}}]),n}();return function(t){var e=this,n=new s(t);return this.mark=function(t,r){return n.mark(t,r),e},this.markRegExp=function(t,r){return n.markRegExp(t,r),e},this.markRanges=function(t,r){return n.markRanges(t,r),e},this.unmark=function(t){return n.unmark(t),e},this.getVersion=function(){return"2.4.0"},this}}));
