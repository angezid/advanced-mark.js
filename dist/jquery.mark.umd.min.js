/*!***************************************************
* advanced-mark.js v1.1.2
* https://github.com/angezid/advanced-mark#readme
* MIT licensed
* Copyright (c) 2022–2023, angezid
* Original author Julian Kühnel, license https://git.io/vwTVl
*****************************************************/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).Mark=t(e.jQuery)}(this,(function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=t(e);class r{constructor(e,t=!0,s=[],r=5e3,o=!1){this.ctx=e,this.iframes=t,this.exclude=s,this.iframesTimeout=r,this.shadowDOM=o}static matches(e,t){const s="string"==typeof t?[t]:t;if(!s)return!1;const r=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;if(r){let t=!1;return s.every((s=>!r.call(e,s)||(t=!0,!1))),t}return!1}getContexts(){let e,t=[];return e=void 0!==this.ctx&&this.ctx?NodeList.prototype.isPrototypeOf(this.ctx)?Array.prototype.slice.call(this.ctx):Array.isArray(this.ctx)?this.ctx:"string"==typeof this.ctx?Array.prototype.slice.call(document.querySelectorAll(this.ctx)):[this.ctx]:[],e.forEach((e=>{const s=t.filter((t=>t.contains(e))).length>0;-1!==t.indexOf(e)||s||t.push(e)})),t}getIframeContents(e,t,s=(()=>{})){let r;try{const t=e.contentWindow;if(r=t.document,!t||!r)throw new Error("iframe inaccessible")}catch(e){s()}r&&t(r)}isIframeBlank(e){const t="about:blank",s=e.getAttribute("src").trim();return e.contentWindow.location.href===t&&s!==t&&s}observeIframeLoad(e,t,s){let r=!1,o=null;const n=()=>{if(!r){r=!0,clearTimeout(o);try{this.isIframeBlank(e)||(e.removeEventListener("load",n),this.getIframeContents(e,t,s))}catch(e){s()}}};e.addEventListener("load",n),o=setTimeout(n,this.iframesTimeout)}onIframeReady(e,t,s){try{"complete"===e.contentWindow.document.readyState?this.isIframeBlank(e)?this.observeIframeLoad(e,t,s):this.getIframeContents(e,t,s):this.observeIframeLoad(e,t,s)}catch(e){s()}}waitForIframes(e,t){let s=0;this.forEachIframe(e,(()=>!0),(e=>{s++,this.waitForIframes(e.querySelector("html"),(()=>{--s||t()}))}),(e=>{e||t()}))}forEachIframe(e,t,s,o=(()=>{})){let n=e.querySelectorAll("iframe"),a=n.length,i=0;n=Array.prototype.slice.call(n);const h=()=>{--a<=0&&o(i)};a||h(),n.forEach((e=>{r.matches(e,this.exclude)?h():this.onIframeReady(e,(r=>{t(e)&&(i++,s(r)),h()}),h)}))}createIterator(e,t,s){return document.createNodeIterator(e,t,s,!1)}iterateNodesIncludeShadowDOM(e,t,s,r){const o=t===NodeFilter.SHOW_TEXT,n=this.shadowDOM.style?this.createStyleElement():null;o&&(t=NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);const a=e=>{const i=this.createIterator(e,t);for(;e=i.nextNode();)e.nodeType===Node.ELEMENT_NODE?(o||s(e)!==NodeFilter.FILTER_ACCEPT||r(e),e.shadowRoot&&"open"===e.shadowRoot.mode&&(this.addRemoveStyle(e.shadowRoot,n,o),a(e.shadowRoot))):o&&e.nodeType===Node.TEXT_NODE&&s(e)===NodeFilter.FILTER_ACCEPT&&r(e)};a(e)}addRemoveStyle(e,t,s){if(s){if(!t||!e.firstChild||e.querySelector("style[data-markjs]"))return;e.insertBefore(t,e.firstChild)}else{let t=e.querySelector("style[data-markjs]");t&&e.removeChild(t)}}createStyleElement(){const e=document.createElement("style");return e.setAttribute("data-markjs","true"),e.textContent=this.shadowDOM.style,e}createInstanceOnIframe(e){return new r(e.querySelector("html"),this.iframes)}compareNodeIframe(e,t,s){if(e.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_PRECEDING){if(null===t)return!0;if(t.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_FOLLOWING)return!0}return!1}getIteratorNode(e){const t=e.previousNode();let s;return s=(null===t||e.nextNode())&&e.nextNode(),{prevNode:t,node:s}}checkIframeFilter(e,t,s,r){let o=!1,n=!1;return r.forEach(((e,t)=>{e.val===s&&(o=t,n=e.handled)})),this.compareNodeIframe(e,t,s)?(!1!==o||n?!1===o||n||(r[o].handled=!0):r.push({val:s,handled:!0}),!0):(!1===o&&r.push({val:s,handled:!1}),!1)}handleOpenIframes(e,t,s,r){e.forEach((e=>{e.handled||this.getIframeContents(e.val,(e=>{this.createInstanceOnIframe(e).forEachNode(t,s,r)}))}))}iterateThroughNodes(e,t,s,r,o){if(this.iframes){let o=[],n=[];const a=this.createIterator(t,e,r);let i,h;const c=()=>(({prevNode:h,node:i}=this.getIteratorNode(a)),i);for(;c();)this.forEachIframe(t,(e=>this.checkIframeFilter(i,h,e,o)),(t=>{this.createInstanceOnIframe(t).forEachNode(e,(e=>n.push(e)),r)})),n.push(i);n.forEach((e=>{s(e)})),this.handleOpenIframes(o,e,s,r)}else if(this.shadowDOM)this.iterateNodesIncludeShadowDOM(t,e,r,s);else{const o=this.createIterator(t,e,r);let n;for(;n=o.nextNode();)s(n)}o()}forEachNode(e,t,s,r=(()=>{})){const o=this.getContexts();let n=o.length;n||r(),o.forEach((o=>{const a=()=>{this.iterateThroughNodes(e,o,t,s,(()=>{--n<=0&&r()}))};this.iframes?this.waitForIframes(o,a):a()}))}}class o{constructor(e){this.opt=Object.assign({},{diacritics:!0,synonyms:{},accuracy:"partially",caseSensitive:!1,ignoreJoiners:!1,ignorePunctuation:[],wildcards:"disabled"},e)}create(e,t){return"disabled"!==this.opt.wildcards&&(e=this.setupWildcardsRegExp(e)),e=this.escapeStr(e),Object.keys(this.opt.synonyms).length&&(e=this.createSynonymsRegExp(e)),(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(e=this.setupIgnoreJoinersRegExp(e)),this.opt.diacritics&&(e=this.createDiacriticsRegExp(e)),e=this.createMergedBlanksRegExp(e),(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(e=this.createJoinersRegExp(e)),"disabled"!==this.opt.wildcards&&(e=this.createWildcardsRegExp(e)),t?this.createAccuracyRegExp(e,!0):(e=this.createAccuracyRegExp(e,!1),new RegExp(e,"gm"+(this.opt.caseSensitive?"":"i")))}createCombinePattern(e,t){if(!Array.isArray(e)||!e.length)return null;const s=t?"(":"(?:",r=this.create(e[0],!0),o=r.lookbehind,n=r.lookahead;return{lookbehind:o,pattern:e.map((e=>`${s}${this.create(e,!0).pattern})`)).join("|"),lookahead:n}}sortByLength(e){return e.sort(((e,t)=>e.length===t.length?e>t?1:-1:t.length-e.length))}escapeStr(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}createSynonymsRegExp(e){const t=this.opt.synonyms,s=this.opt.caseSensitive?"":"i";for(let r in t)if(t.hasOwnProperty(r)){let o=Array.isArray(t[r])?t[r]:[t[r]];if(o.unshift(r),o=this.sortByLength(o).map((e=>("disabled"!==this.opt.wildcards&&(e=this.setupWildcardsRegExp(e)),e=this.escapeStr(e)))).filter((e=>""!==e)),o.length>1){const t=o.map((e=>this.escapeStr(e))).join("|");e=e.replace(new RegExp(t,`gm${s}`),`(?:${o.join("|")})`)}}return e}setupWildcardsRegExp(e){return(e=e.replace(/(?:\\)*\?/g,(e=>"\\"===e.charAt(0)?"?":""))).replace(/(?:\\)*\*/g,(e=>"\\"===e.charAt(0)?"*":""))}createWildcardsRegExp(e){const t="withSpaces"===this.opt.wildcards,s=this.opt.blockElementsBoundary,r=t&&s?"[^"+(s.char?s.char:"")+"]*?":"[\\S\\s]*?";return e.replace(/\u0001/g,t?"[\\S\\s]?":"\\S?").replace(/\u0002/g,t?r:"\\S*")}setupIgnoreJoinersRegExp(e){return e.replace(/(\(\?:|\|)|\\?.(?=([|)]|$)|.)/g,((e,t,s)=>t||void 0!==s?e:e+"\0"))}createJoinersRegExp(e){let t=[];const s=this.opt.ignorePunctuation;return Array.isArray(s)&&s.length&&t.push(this.escapeStr(s.join(""))),this.opt.ignoreJoiners&&t.push("\\u00ad\\u200b\\u200c\\u200d"),t.length?e.split(/\u0000+/).join(`[${t.join("")}]*`):e}createDiacriticsRegExp(e){const t=this.opt.caseSensitive,s=["aàáảãạăằắẳẵặâầấẩẫậäåāą","AÀÁẢÃẠĂẰẮẲẴẶÂẦẤẨẪẬÄÅĀĄ","cçćč","CÇĆČ","dđď","DĐĎ","eèéẻẽẹêềếểễệëěēę","EÈÉẺẼẸÊỀẾỂỄỆËĚĒĘ","iìíỉĩịîïī","IÌÍỈĨỊÎÏĪ","lł","LŁ","nñňń","NÑŇŃ","oòóỏõọôồốổỗộơởỡớờợöøō","OÒÓỎÕỌÔỒỐỔỖỘƠỞỠỚỜỢÖØŌ","rř","RŘ","sšśșş","SŠŚȘŞ","tťțţ","TŤȚŢ","uùúủũụưừứửữựûüůū","UÙÚỦŨỤƯỪỨỬỮỰÛÜŮŪ","yýỳỷỹỵÿ","YÝỲỶỸỴŸ","zžżź","ZŽŻŹ"];return e.split("").map((e=>{for(let r=0;r<s.length;r+=2)if(t){if(-1!==s[r].indexOf(e))return"["+s[r]+"]";if(-1!==s[r+1].indexOf(e))return"["+s[r+1]+"]"}else if(-1!==s[r].indexOf(e)||-1!==s[r+1].indexOf(e))return"["+s[r]+s[r+1]+"]";return e})).join("")}createMergedBlanksRegExp(e){return e.replace(/\s+/g,"[\\s]+")}createAccuracyRegExp(e,t){let s=this.opt.accuracy,r="string"==typeof s?s:s.value,o="string"==typeof s?[]:s.limiters,n="";o.forEach((e=>{n+=`|${this.escapeStr(e)}`}));let a,i="()",h="";switch(r){case"partially":default:a=e;break;case"complementary":n="\\s"+(n||this.escapeStr("!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~¡¿")),a=`[^${n}]*${e}[^${n}]*`;break;case"exactly":i=`(^|\\s${n})`,a=e,h=`(?=$|\\s${n})`}return t?{lookbehind:i,pattern:a,lookahead:h}:`${i}(${a})${h}`}}class n{constructor(e){this.version="1.1.2",this.ctx=e,this.cacheDict={},this.nodeNames=["script","style","title","head","html"],this.ie=!1;const t=window.navigator.userAgent;(t.indexOf("MSIE")>-1||t.indexOf("Trident")>-1)&&(this.ie=!0)}set opt(e){this._opt=Object.assign({},{element:"",className:"",exclude:[],iframes:!1,iframesTimeout:5e3,separateWordSearch:!0,acrossElements:!1,ignoreGroups:0,each:()=>{},noMatch:()=>{},filter:()=>!0,done:()=>{},debug:!1,log:window.console},e)}get opt(){return this._opt}get iterator(){return new r(this.ctx,this.opt.iframes,this.opt.exclude,this.opt.iframesTimeout,this.opt.shadowDOM)}log(e,t="debug"){const s=this.opt.log;this.opt.debug&&"object"==typeof s&&"function"==typeof s[t]&&s[t](`mark.js: ${e}`)}checkOption(e){let t=!0;return e&&e.cacheTextNodes&&this.cacheDict.type&&(e.acrossElements?"across"===this.cacheDict.type&&(t=!1):"every"===this.cacheDict.type&&(t=!1)),t&&(this.cacheDict={}),e}getSeparatedKeywords(e){let t=[];return e.forEach((e=>{this.opt.separateWordSearch?e.split(" ").forEach((e=>{e.trim()&&-1===t.indexOf(e)&&t.push(e)})):e.trim()&&-1===t.indexOf(e)&&t.push(e)})),{keywords:t.sort(((e,t)=>t.length-e.length)),length:t.length}}isNumeric(e){return Number(parseFloat(e))==e}checkRanges(e){if(!Array.isArray(e)||"[object Object]"!==Object.prototype.toString.call(e[0]))return this.log("markRanges() will only accept an array of objects"),this.opt.noMatch(e),[];const t=[];let s=0;return e.sort(((e,t)=>e.start-t.start)).forEach((e=>{let{start:r,end:o,valid:n}=this.callNoMatchOnInvalidRanges(e,s);n&&(e.start=r,e.length=o-r,t.push(e),this.opt.wrapAllRanges||(s=o))})),t}callNoMatchOnInvalidRanges(e,t){let s,r,o=!1;return e&&void 0!==e.start?(s=parseInt(e.start,10),r=s+parseInt(e.length,10),this.isNumeric(e.start)&&this.isNumeric(e.length)&&s>=t&&r>s?o=!0:(this.log(`Ignoring invalid or overlapping range: ${JSON.stringify(e)}`),this.opt.noMatch(e))):(this.log(`Ignoring invalid range: ${JSON.stringify(e)}`),this.opt.noMatch(e)),{start:s,end:r,valid:o}}checkWhitespaceRanges(e,t,s){let r,o=!0,n=s.length,a=t-n,i=parseInt(e.start,10)-a;return i=i>n?n:i,r=i+parseInt(e.length,10),r>n&&(r=n,this.log(`End range automatically set to the max value of ${n}`)),i<0||r-i<=0?(o=!1,this.log(`Invalid range: ${JSON.stringify(e)}`),this.opt.noMatch(e)):/\S/.test(s.substring(i,r))||(o=!1,this.log("Skipping whitespace only range: "+JSON.stringify(e)),this.opt.noMatch(e)),{start:i,end:r,valid:o}}checkParents(e,t){if(e===e.parentNode.lastChild){if(t(e.parentNode))return!0;{let s=e.parentNode;for(;s.parentNode&&s===s.parentNode.lastChild;){if(t(s.parentNode))return!0;s=s.parentNode}}let s=e.parentNode.nextSibling;if(s){if(1!==s.nodeType)return!0;if(t(s))return!0}}return!1}checkNextSiblings(e,t){if(e&&1===e.nodeType){if(t(e))return;if(e.firstChild){let s,r=e.firstChild;for(;r;){if(1!==r.nodeType)return;if(t(r))return;s=r,r=r.firstChild}this.checkNextSiblings(s.nextSibling,t)}e!==e.parentNode.lastChild?this.checkNextSiblings(e.nextSibling,t):t(e.parentNode)}}setType(e){const t=this.opt.blockElementsBoundary,s=Array.isArray(t.tagNames)&&t.tagNames.length;if(s&&t.tagNames.map((e=>e.toLowerCase())).forEach((t=>{e[t]=2})),!s||t.extend)for(const t in e)e[t]=2;e.br=1}getTextNodesAcrossElements(e){if(this.opt.cacheTextNodes&&this.cacheDict.nodes)return this.cacheDict.lastIndex=0,this.cacheDict.lastTextIndex=0,void e(this.cacheDict);let t,s,r,o,n,a,i="",h=0,c=" ";const l=[],d=this.opt.blockElementsBoundary,p={div:1,p:1,li:1,td:1,tr:1,th:1,ul:1,ol:1,br:1,dd:1,dl:1,dt:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,blockquote:1,figcaption:1,figure:1,pre:1,table:1,thead:1,tbody:1,tfoot:1,input:1,img:1,nav:1,details:1,label:1,form:1,select:1,menu:1,menuitem:1,main:1,section:1,article:1,aside:1,picture:1,output:1,button:1,header:1,footer:1,address:1,area:1,canvas:1,map:1,fieldset:1,textarea:1,track:1,video:1,audio:1,body:1,iframe:1,meter:1,object:1,svg:1};d&&(this.setType(p),d.char&&(c=d.char.charAt(0)+" "),a=" "+c),this.iterator.forEachNode(NodeFilter.SHOW_TEXT,(e=>{if(n=0,t=i.length,s=e.textContent,r=/\s/.test(s[s.length-1]),d||!r){this.checkParents(e,(e=>(o=p[e.nodeName.toLowerCase()],o)))||this.checkNextSiblings(e.nextSibling,(e=>(o=p[e.nodeName.toLowerCase()],o))),o&&(r?2===o&&(i+=s+c,n=2):1===o?(i+=s+" ",n=1):2===o&&(i+=s+a,n=3))}0===n&&(i+=s),l.push({start:t,end:i.length-n,offset:n,startOffset:h,node:e}),h-=n}),(e=>this.matchesExclude(e.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT),(()=>{const t={value:i,nodes:l,lastIndex:0,lastTextIndex:0};this.opt.cacheTextNodes&&(this.cacheDict=t,this.cacheDict.type="across"),e(t)}))}getTextNodes(e){if(this.opt.cacheTextNodes&&this.cacheDict.nodes)return void e(this.cacheDict);let t="",s=[];this.iterator.forEachNode(NodeFilter.SHOW_TEXT,(e=>{s.push({start:t.length,end:(t+=e.textContent).length,offset:0,node:e})}),(e=>this.matchesExclude(e.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT),(()=>{const r={value:t,nodes:s,lastIndex:0,lastTextIndex:0};this.opt.cacheTextNodes&&(this.cacheDict=r,this.cacheDict.type="every"),e(r)}))}matchesExclude(e){return-1!==this.nodeNames.indexOf(e.nodeName.toLowerCase())||this.opt.exclude&&this.opt.exclude.length&&r.matches(e,this.opt.exclude)}wrapRangeInTextNode(e,t,s){const r=e.splitText(t),o=r.splitText(s-t);return this.createMarkElement(r),o}createMarkElement(e){const t=this.opt.element?this.opt.element:"mark";let s=document.createElement(t);return s.setAttribute("data-markjs","true"),this.opt.className&&s.setAttribute("class",this.opt.className),s.textContent=e.textContent,e.parentNode.replaceChild(s,e),s}wrapRangeInTextNodeInsert(e,t,s,r,o,n){let a=r===t.node.textContent.length;if(0===s&&a){let e=this.createMarkElement(t.node);return t.node=e.childNodes[0],{retNode:t,markNode:e,increment:0}}let i=t.node.splitText(s),h=i.splitText(r-s),c=this.createMarkElement(i),l=1,d={start:o,end:t.start+r,offset:0,node:c.childNodes[0]},p={start:t.start+r,end:t.end,offset:t.offset,node:h};return 0===s?e.nodes.splice(n,1,d,p):(a?e.nodes.splice(n+1,0,d):(e.nodes.splice(n+1,0,d,p),l=2),t.end=o,t.offset=0),{retNode:p,markNode:c,increment:l}}wrapRangeInMappedTextNode(e,t,s,r,o){let n=e.lastIndex,a=!0;const i=this.opt.wrapAllRanges||this.opt.cacheTextNodes;if(i)for(;n>=0&&e.nodes[n].start>t;)n--;else if(t<e.lastTextIndex)return;for(;n<e.nodes.length;n++)if(n+1===e.nodes.length||e.nodes[n+1].start>t){let h=e.nodes[n];if(!r(h)){n>e.lastIndex&&(e.lastIndex=n);break}const c=t-h.start,l=(s>h.end?h.end:s)-h.start;if(c>=0&&l>c){if(i){let s=this.wrapRangeInTextNodeInsert(e,h,c,l,t,n);h=s.retNode,o(s.markNode,a)}else h.node=this.wrapRangeInTextNode(h.node,c,l),h.start+=l,e.lastTextIndex=h.start,o(h.node.previousSibling,a);a=!1}if(!(s>h.end)){e.lastIndex=n;break}t=h.end+h.offset}}wrapGroups(e,t,s,r){return r((e=this.wrapRangeInTextNode(e,t,t+s)).previousSibling),e}separateGroupsD(e,t,s,r,o){let n,a,i=0,h=0,c=0,l=!1,d=0;for(;++c<t.length;)n=t[c],n&&(a=t.indices[c][0],a>=i&&(d=t.indices[c][1],r(n,e,c)&&(e=this.wrapGroups(e,a-h,d-a,(e=>{o(e,c)})),d>i&&(i=d),h=d,l=!0)));return l?s.regex.lastIndex=0:0===t[0].length&&this.setLastIndex(s.regex,d),e}separateGroups(e,t,s,r,o){let n,a,i,h=t.index,c=-1,l=!1;for(;++c<s.groups.length;)n=s.groups[c],a=t[n],a&&(i=e.textContent.indexOf(a,h),-1!==i&&(r(a,e,n)?(e=this.wrapGroups(e,i,a.length,(e=>{o(e,n)})),h=0,l=!0):h=i+a.length));return l&&(s.regex.lastIndex=0),e}wrapMatchGroupsD(e,t,s,r,o){let n,a,i,h=0,c=0,l=0;for(;++c<t.length;)n=t[c],n&&(a=t.indices[c][0],(this.opt.wrapAllRanges||a>=h)&&(l=t.indices[c][1],i=!1,this.wrapRangeInMappedTextNode(e,a,l,(e=>r(n,e,c)),((e,t)=>{i=!0,o(e,t,c)})),i&&l>h&&(h=l)));0===t[0].length&&this.setLastIndex(s.regex,l)}setLastIndex(e,t){t>e.lastIndex?e.lastIndex=t:t>0?e.lastIndex++:e.lastIndex=1/0}wrapMatchGroups(e,t,s,r,o){let n,a,i,h=0,c=0;const l=t.index,d=t[0];this.opt.wrapAllRanges&&this.wrapRangeInMappedTextNode(e,l,l+d.length,(e=>r(d,e,c)),((e,t)=>{o(e,t,c)}));for(let p=0;p<s.groups.length;p++)c=s.groups[p],n=t[c],n&&(a=d.indexOf(n,h),i=a+n.length,-1!==a&&(this.wrapRangeInMappedTextNode(e,l+a,l+i,(e=>r(n,e,c)),((e,t)=>{o(e,t,c)})),h=i))}collectRegexGroupIndexes(e){let t=[],s=[],r=-1,o=1,n=0,a=!1,i=e.source,h=/^\(\?<(?![=!])|^\((?!\?)/;for(;++r<i.length;)switch(i[r]){case"(":a||(h.test(i.substring(r))?(s.push(1),0===n&&t.push(o),n++,o++):s.push(0));break;case")":a||1!==s.pop()||n--;break;case"\\":r++;break;case"[":a=!0;break;case"]":a=!1}return t}wrapSeparateGroups(e,t,s,r,o){const n=e.hasIndices?"separateGroupsD":"separateGroups",a={regex:e,groups:e.hasIndices?{}:this.collectRegexGroupIndexes(e)},i={abort:!1},h={execution:i};let c,l,d,p,u=0;this.getTextNodes((t=>{t.nodes.every((t=>{for(c=t.node,h.offset=t.start;null!==(l=e.exec(c.textContent))&&(e.hasIndices||""!==l[0])&&(h.match=l,d=p=!0,c=this[n](c,l,a,((e,t,r)=>(h.matchStart=d,h.groupIndex=r,d=!1,s(e,t,h))),((e,t)=>{p&&u++,r(e,{match:l,matchStart:p,count:u,groupIndex:t}),p=!1})),!i.abort););return!i.abort})),o(u)}))}wrapMatches(e,t,s,r,o){const n=0===t?0:t+1,a={abort:!1},i={execution:a};let h,c,l,d=0;this.getTextNodes((t=>{for(let o=0;o<t.nodes.length;o++){for(h=t.nodes[o],c=h.node;null!==(l=e.exec(c.textContent))&&""!==l[n];){if(i.match=l,i.offset=h.start,!s(l[n],c,i))continue;let p=l[n].length,u=l.index;if(0!==n)for(let e=1;e<n;e++)u+=l[e].length;if(this.opt.cacheTextNodes){const s=this.wrapRangeInTextNodeInsert(t,h,u,u+p,h.start+u,o);if(d++,r(s.markNode,{match:l,count:d}),0===s.increment){e.lastIndex=0;break}o+=s.increment,h=s.retNode,c=h.node}else c=this.wrapGroups(c,u,p,(e=>{d++,r(e,{match:l,count:d})}));if(e.lastIndex=0,a.abort)break}if(a.abort)break}o(d)}))}wrapGroupsAcrossElements(e,t,s,r,o){const n=e.hasIndices?"wrapMatchGroupsD":"wrapMatchGroups",a={regex:e,groups:e.hasIndices?{}:this.collectRegexGroupIndexes(e)},i={abort:!1},h={execution:i};let c,l,d,p=0;this.getTextNodesAcrossElements((t=>{for(;null!==(c=e.exec(t.value))&&(e.hasIndices||""!==c[0])&&(h.match=c,l=d=!0,this[n](t,c,a,((e,t,r)=>(h.matchStart=l,h.groupIndex=r,h.offset=t.startOffset,l=!1,s(e,t.node,h))),((e,t,s)=>{d&&p++,r(e,{match:c,matchStart:d,count:p,groupIndex:s,groupStart:t}),d=!1})),!i.abort););o(p)}))}wrapMatchesAcrossElements(e,t,s,r,o){const n=0===t?0:t+1,a={abort:!1},i={execution:a};let h,c,l=0;this.getTextNodesAcrossElements((t=>{for(;null!==(h=e.exec(t.value))&&""!==h[n];){i.match=h,c=!0;let e=h.index;if(0!==n)for(let t=1;t<n;t++)e+=h[t].length;const o=e+h[n].length;if(this.wrapRangeInMappedTextNode(t,e,o,(e=>(i.matchStart=c,i.offset=e.startOffset,c=!1,s(h[n],e.node,i))),((e,t)=>{t&&l++,r(e,{match:h,matchStart:t,count:l})})),a.abort)break}o(l)}))}wrapRangeFromIndex(e,t,s,r){let o=0;this.getTextNodes((n=>{const a=n.value.length;e.forEach(((e,r)=>{let{start:i,end:h,valid:c}=this.checkWhitespaceRanges(e,a,n.value);c&&this.wrapRangeInMappedTextNode(n,i,h,(s=>t(s.node,e,n.value.substring(i,h),r)),((t,r)=>{r&&o++,s(t,e,{matchStart:r,count:o})}))})),r(o)}))}unwrapMatches(e){const t=e.parentNode;let s=document.createDocumentFragment();for(;e.firstChild;)s.appendChild(e.removeChild(e.firstChild));t.replaceChild(s,e),this.ie?this.normalizeTextNode(t):t.normalize()}normalizeTextNode(e){if(e){if(3===e.nodeType)for(;e.nextSibling&&3===e.nextSibling.nodeType;)e.nodeValue+=e.nextSibling.nodeValue,e.parentNode.removeChild(e.nextSibling);else this.normalizeTextNode(e.firstChild);this.normalizeTextNode(e.nextSibling)}}markRegExp(e,t){this.opt=this.checkOption(t);let s=0,r=this.opt.separateGroups?"wrapSeparateGroups":"wrapMatches";if(this.opt.acrossElements&&(r=this.opt.separateGroups?"wrapGroupsAcrossElements":"wrapMatchesAcrossElements"),this.opt.acrossElements&&!e.global&&!e.sticky){let t=e.toString().split("/");e=new RegExp(e.source,"g"+t[t.length-1]),this.log("RegExp was recompiled because it must have g flag")}this.log(`Searching with expression "${e}"`),this[r](e,this.opt.ignoreGroups,((e,t,r)=>this.opt.filter(t,e,s,r)),((e,t)=>{s++,this.opt.each(e,t)}),(t=>{0===t&&this.opt.noMatch(e),this.opt.done(s,t)}))}mark(e,t){if(t&&t.combinePatterns)return void this.markCombinePatterns(e,t);this.opt=this.checkOption(t);let s=0,r=0,n=0;const a=this.opt.acrossElements?"wrapMatchesAcrossElements":"wrapMatches",i={},{keywords:h,length:c}=this.getSeparatedKeywords("string"==typeof e?[e]:e),l=e=>{const t=new o(this.opt).create(e);let d=0;this.log(`Searching with expression "${t}"`),this[a](t,1,((t,s,o)=>this.opt.filter(s,e,r,d,o)),((e,t)=>{d++,r++,this.opt.each(e,t)}),(t=>{n+=t,0===t&&this.opt.noMatch(e),i[e]=t,++s<c?l(h[s]):this.opt.done(r,n,i)}))};0===c?this.opt.done(0,0,i):l(h[s])}markCombinePatterns(e,t){this.opt=this.checkOption(t);let s,r=0,o=0,n=0,a=[],i=[];const h=this.opt.acrossElements,c=h?"wrapMatchesAcrossElements":"wrapMatches",l="gm"+(this.opt.caseSensitive?"":"i"),d={},p=this.getSeparatedKeywords("string"==typeof e?[e]:e),u=e=>{const t=new RegExp(e,l),p=i[r];this.log(`Searching with expression "${t}"`),this[c](t,1,((e,t,r)=>(h?r.matchStart&&(s=this.getCurrentTerm(r.match,p)):s=this.getCurrentTerm(r.match,p),this.opt.filter(t,s,o,d[s],r))),((e,t)=>{o++,h?t.matchStart&&(d[s]+=1):d[s]+=1,this.opt.each(e,t)}),(e=>{n+=e;const t=p.filter((e=>0===d[e]));t.length&&this.opt.noMatch(t),++r<a.length?u(a[r]):this.opt.done(o,n,d)}))};if(0===p.length)this.opt.done(0,0,d);else{p.keywords.forEach((e=>{d[e]=0}));const e=this.getPatterns(p.keywords);i=e.terms,a=e.patterns,u(a[r])}}getCurrentTerm(e,t){let s=e.length;for(;--s>2;)if(e[s])return t[s-3];return" "}getPatterns(e){const t=new o(this.opt),s=t.create(e[0],!0),r=[],n=[];let a=10;"number"==typeof this.opt.combinePatterns&&(this.opt.combinePatterns===1/0?a=Math.pow(2,31):this.isNumeric(this.opt.combinePatterns)&&(a=parseInt(this.opt.combinePatterns)));let i=Math.ceil(e.length/a);for(let o=0;o<i;o++){let i=s.lookbehind+"(";const h=[],c=Math.min(o*a+a,e.length);for(let t=o*a;t<c;t++)h.push(e[t]);i+=t.createCombinePattern(h,!0).pattern,r.push(i+")"+s.lookahead),n.push(h)}return{patterns:r,terms:n}}markRanges(e,t){this.opt=t,this.cacheDict={};let s=0,r=this.checkRanges(e);r&&r.length?(this.log("Starting to mark with the following ranges: "+JSON.stringify(r)),this.wrapRangeFromIndex(r,((e,t,s,r)=>this.opt.filter(e,t,s,r)),((e,t,r)=>{s++,this.opt.each(e,t,r)}),(e=>{this.opt.done(s,e)}))):this.opt.done(0,0)}unmark(e){this.opt=e,this.cacheDict={};let t=(this.opt.element?this.opt.element:"mark")+"[data-markjs]";this.opt.className&&(t+=`.${this.opt.className}`),this.log(`Removal selector "${t}"`),this.iterator.forEachNode(NodeFilter.SHOW_ELEMENT,(e=>{this.unwrapMatches(e)}),(e=>r.matches(e,t)&&!this.matchesExclude(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT),this.opt.done)}}return s.default.fn.mark=function(e,t){return new n(this.get()).mark(e,t),this},s.default.fn.markRegExp=function(e,t){return new n(this.get()).markRegExp(e,t),this},s.default.fn.markRanges=function(e,t){return new n(this.get()).markRanges(e,t),this},s.default.fn.unmark=function(e){return new n(this.get()).unmark(e),this},s.default.fn.getVersion=function(){return new n(this.get()).version},s.default}));
