/*!***************************************************
* advanced-mark.js v2.0.0
* https://github.com/angezid/advanced-mark#readme
* MIT licensed
* Copyright (c) 2022–2023, angezid
* Original author Julian Kühnel, license https://git.io/vwTVl
*****************************************************/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).Mark=t(e.jQuery)}(this,(function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=t(e);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(this,arguments)}var c=function(){function e(t,n){a(this,e),this.ctx=t,this.opt=n,this.attrName="data-markjsListener"}return i(e,[{key:"getContexts",value:function(){var e;e=void 0!==this.ctx&&this.ctx?NodeList.prototype.isPrototypeOf(this.ctx)?Array.prototype.slice.call(this.ctx):Array.isArray(this.ctx)?this.ctx:"string"==typeof this.ctx?Array.prototype.slice.call(document.querySelectorAll(this.ctx)):[this.ctx]:[];var t=[];return e.forEach((function(e){-1!==t.indexOf(e)||t.some((function(t){return t.contains(e)}))||t.push(e)})),t}},{key:"getIframeContents",value:function(e,t,n){try{var r=e.contentWindow.document;r&&(e.setAttribute(this.attrName,"completed"),t({iframe:e,context:r}))}catch(t){e.setAttribute(this.attrName,"error"),n({iframe:e,error:t})}}},{key:"isIframeBlank",value:function(e){var t="about:blank",n=e.getAttribute("src").trim();return e.contentWindow.location.href===t&&n!==t&&n}},{key:"observeIframeLoad",value:function(e,t,n){var r=this;if(!e.hasAttribute(this.attrName)){var a=null,o=function o(){clearTimeout(a),e.removeEventListener("load",o),r.getIframeContents(e,t,n)};e.addEventListener("load",o),e.setAttribute(this.attrName,!0),a=setTimeout(o,this.opt.iframesTimeout)}}},{key:"onIframeReady",value:function(e,t,n){try{"complete"===e.contentWindow.document.readyState?this.isIframeBlank(e)?this.observeIframeLoad(e,t,n):this.getIframeContents(e,t,n):this.observeIframeLoad(e,t,n)}catch(e){n(e)}}},{key:"waitForAllIframes",value:function(t,n){var r=this,a=0,o=[],i=[],s=!1,c=setTimeout((function(){s=!0,n()}),this.opt.iframesTimeout),u=function(){clearTimeout(c),s||n()},l=function(){a===o.filter((function(e){return!r.hasAttributeValue(e,r.attrName,"error")})).length&&u()};!function t(n){n.iframe&&"about:blank"===n.context.location.href||(i=[],n.context.querySelectorAll(n.iframe?"body iframe":"iframe").forEach((function(t){e.matches(t,r.opt.exclude)||(o.push(t),t.hasAttribute(r.attrName)||i.push(t))})),n.iframe||i.length)?i.length?i.forEach((function(e){r.onIframeReady(e,(function(e){a++,t(e)}),(function(e){r.opt.debug&&console.log(e.error),l()}))})):l():u()}({context:t})}},{key:"createIterator",value:function(e,t,n){return document.createNodeIterator(e,t,n,!1)}},{key:"addRemoveStyle",value:function(e,t,n){if(n){if(!t||!e.firstChild||e.querySelector("style[data-markjs]"))return;e.insertBefore(t,e.firstChild)}else{var r=e.querySelector("style[data-markjs]");r&&e.removeChild(r)}}},{key:"createStyleElement",value:function(){var e=document.createElement("style");return e.setAttribute("data-markjs","true"),e.textContent=this.opt.shadowDOM.style,e}},{key:"hasAttributeValue",value:function(e,t,n){return e.hasAttribute(t)&&e.getAttribute(t)===n}},{key:"iterateThroughNodes",value:function(t,n,r,a,o){var i=this,s=this.opt.shadowDOM,c=this.opt.iframes;if(c||s){var u=0!=(n&NodeFilter.SHOW_ELEMENT),l=0!=(n&NodeFilter.SHOW_TEXT),h=s&&s.style?this.createStyleElement():null;l&&(n=NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);!function t(o){for(var f=i.createIterator(o,n);o=f.nextNode();)o.nodeType===Node.ELEMENT_NODE?(u&&r(o)===NodeFilter.FILTER_ACCEPT&&a(o),c&&"IFRAME"===o.nodeName.toUpperCase()&&!e.matches(o,i.opt.exclude)&&i.hasAttributeValue(o,i.attrName,"completed")&&i.getIframeContents(o,(function(e){t(e.context)}),(function(){})),s&&o.shadowRoot&&"open"===o.shadowRoot.mode&&(i.addRemoveStyle(o.shadowRoot,h,l),t(o.shadowRoot))):l&&o.nodeType===Node.TEXT_NODE&&r(o)===NodeFilter.FILTER_ACCEPT&&a(o)}(t)}else for(var f,p=this.createIterator(t,n,r);f=p.nextNode();)a(f);o()}},{key:"forEachNode",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},o=this.getContexts(),i=o.length;i||a(),o.forEach((function(o){i--;var s=function(){r.iterateThroughNodes(o,e,n,t,(function(){i<=0&&a()}))};r.opt.iframes?r.waitForAllIframes(o,s):s()}))}}],[{key:"matches",value:function(e,t){var n="string"==typeof t?[t]:t;if(!n)return!1;var r=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;return!!r&&n.some((function(t){return!0===r.call(e,t)}))}}]),e}(),u=function(){function e(t){a(this,e),this.opt=s({},{diacritics:!0,synonyms:{},accuracy:"partially",caseSensitive:!1,ignoreJoiners:!1,ignorePunctuation:[],wildcards:"disabled"},t)}return i(e,[{key:"create",value:function(e,t){return"disabled"!==this.opt.wildcards&&(e=this.setupWildcardsRegExp(e)),e=this.escapeStr(e),Object.keys(this.opt.synonyms).length&&(e=this.createSynonymsRegExp(e)),(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(e=this.setupIgnoreJoinersRegExp(e)),this.opt.diacritics&&(e=this.createDiacriticsRegExp(e)),e=this.createMergedBlanksRegExp(e),(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(e=this.createJoinersRegExp(e)),"disabled"!==this.opt.wildcards&&(e=this.createWildcardsRegExp(e)),t?this.createAccuracyRegExp(e,!0):(e=this.createAccuracyRegExp(e,!1),new RegExp(e,"gm".concat(this.opt.caseSensitive?"":"i")))}},{key:"createCombinePattern",value:function(e,t){var n=this;if(!Array.isArray(e)||!e.length)return null;var r=t?"(":"(?:",a=this.create(e[0],!0),o=a.lookbehind,i=a.lookahead;return{lookbehind:o,pattern:e.map((function(e){return"".concat(r).concat(n.create(e,!0).pattern,")")})).join("|"),lookahead:i}}},{key:"sortByLength",value:function(e){return e.sort((function(e,t){return e.length===t.length?e>t?1:-1:t.length-e.length}))}},{key:"escapeStr",value:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}},{key:"createSynonymsRegExp",value:function(e){var t=this,n=this.opt.synonyms,r=this.opt.caseSensitive?"":"i";for(var a in n)if(n.hasOwnProperty(a)){var o=Array.isArray(n[a])?n[a]:[n[a]];if(o.unshift(a),(o=this.sortByLength(o).map((function(e){return"disabled"!==t.opt.wildcards&&(e=t.setupWildcardsRegExp(e)),e=t.escapeStr(e)})).filter((function(e){return""!==e}))).length>1){var i=o.map((function(e){return t.escapeStr(e)})).join("|");e=e.replace(new RegExp("(?:".concat(i,")"),"gm".concat(r)),"(?:".concat(o.join("|"),")"))}}return e}},{key:"setupWildcardsRegExp",value:function(e){return(e=e.replace(/(?:\\)*\?/g,(function(e){return"\\"===e.charAt(0)?"?":""}))).replace(/(?:\\)*\*/g,(function(e){return"\\"===e.charAt(0)?"*":""}))}},{key:"createWildcardsRegExp",value:function(e){var t="withSpaces"===this.opt.wildcards;return e.replace(/\u0001/g,t?"[\\S\\s]?":"\\S?").replace(/\u0002/g,t?"[\\S\\s]*?":"\\S*")}},{key:"setupIgnoreJoinersRegExp",value:function(e){return e.replace(/(\(\?:|\|)|\\?.(?=([|)]|$)|.)/g,(function(e,t,n){return t||void 0!==n?e:e+"\0"}))}},{key:"createJoinersRegExp",value:function(e){var t=[],n=this.opt.ignorePunctuation;return Array.isArray(n)&&n.length&&t.push(this.escapeStr(n.join(""))),this.opt.ignoreJoiners&&t.push("\\u00ad\\u200b\\u200c\\u200d"),t.length?e.split(/\u0000+/).join("[".concat(t.join(""),"]*")):e}},{key:"createDiacriticsRegExp",value:function(e){var t=this.opt.caseSensitive,n=["aàáảãạăằắẳẵặâầấẩẫậäåāą","AÀÁẢÃẠĂẰẮẲẴẶÂẦẤẨẪẬÄÅĀĄ","cçćč","CÇĆČ","dđď","DĐĎ","eèéẻẽẹêềếểễệëěēę","EÈÉẺẼẸÊỀẾỂỄỆËĚĒĘ","iìíỉĩịîïī","IÌÍỈĨỊÎÏĪ","lł","LŁ","nñňń","NÑŇŃ","oòóỏõọôồốổỗộơởỡớờợöøō","OÒÓỎÕỌÔỒỐỔỖỘƠỞỠỚỜỢÖØŌ","rř","RŘ","sšśșş","SŠŚȘŞ","tťțţ","TŤȚŢ","uùúủũụưừứửữựûüůū","UÙÚỦŨỤƯỪỨỬỮỰÛÜŮŪ","yýỳỷỹỵÿ","YÝỲỶỸỴŸ","zžżź","ZŽŻŹ"];return e.split("").map((function(e){for(var r=0;r<n.length;r+=2)if(t){if(-1!==n[r].indexOf(e))return"["+n[r]+"]";if(-1!==n[r+1].indexOf(e))return"["+n[r+1]+"]"}else if(-1!==n[r].indexOf(e)||-1!==n[r+1].indexOf(e))return"["+n[r]+n[r+1]+"]";return e})).join("")}},{key:"createMergedBlanksRegExp",value:function(e){return e.replace(/\s+/g,"[\\s]+")}},{key:"createAccuracyRegExp",value:function(e,t){var n=this,r=this.opt.accuracy,a="string"==typeof r?r:r.value,o="string"==typeof r?[]:r.limiters,i="";o.forEach((function(e){i+="|".concat(n.escapeStr(e))}));var s,c="()",u="";switch(a){case"partially":default:s=e;break;case"complementary":i="\\s"+(i||this.escapeStr("!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~¡¿")),s="[^".concat(i,"]*").concat(e,"[^").concat(i,"]*");break;case"exactly":c="(^|\\s".concat(i,")"),s=e,u="(?=$|\\s".concat(i,")")}return t?{lookbehind:c,pattern:s,lookahead:u}:"".concat(c,"(").concat(s,")").concat(u)}}]),e}(),l=function(){function e(t){a(this,e),this.version="2.0.0",this.ctx=t,this.cacheDict={}}return i(e,[{key:"opt",get:function(){return this._opt},set:function(e){this._opt=s({},{element:"",className:"",exclude:[],iframes:!1,iframesTimeout:5e3,separateWordSearch:!0,acrossElements:!1,ignoreGroups:0,each:function(){},noMatch:function(){},filter:function(){return!0},done:function(){},debug:!1,log:window.console},e)}},{key:"iterator",get:function(){return new c(this.ctx,this.opt)}},{key:"log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"debug",n=this.opt.log;this.opt.debug&&"object"===r(n)&&"function"==typeof n[t]&&n[t]("mark.js: ".concat(e))}},{key:"report",value:function(e){var t=this;e.forEach((function(e){t.log("".concat(e.text," ").concat(JSON.stringify(e.obj)),e.level?e.level:"debug"),e.skip||t.opt.noMatch(e.obj)}))}},{key:"checkOption",value:function(e){e&&e.acrossElements&&e.cacheTextNodes&&!e.wrapAllRanges&&(e=s({},e,{wrapAllRanges:!0}));var t=!0;return e&&e.cacheTextNodes&&this.cacheDict.type&&(e.acrossElements?"across"===this.cacheDict.type&&(t=!1):"every"===this.cacheDict.type&&(t=!1)),t&&(this.cacheDict={}),e}},{key:"getSeparatedKeywords",value:function(e){var t=this,n=this.isString(e)?[e]:e,r=[],a=function(e){e.trim()&&-1===r.indexOf(e)&&r.push(e)};return n.forEach((function(e){t.opt.separateWordSearch?e.split(" ").forEach((function(e){return a(e)})):a(e)})),r.sort((function(e,t){return t.length-e.length})),r}},{key:"isNumeric",value:function(e){return Number(parseFloat(e))==e}},{key:"isString",value:function(e){return"string"==typeof e}},{key:"isObject",value:function(e){return"[object Object]"===Object.prototype.toString.call(e)}},{key:"isArrayOfObjects",value:function(e){var t=this;return Array.isArray(e)&&e.some((function(e){return t.isObject(e)}))}},{key:"checkRanges",value:function(e,t,n){var r=this,a="error",o=e.filter((function(e){var o=!1;return r.isNumeric(e.start)&&r.isNumeric(e.length)&&(e.start=parseInt(e.start),e.length=parseInt(e.length),e.start>=0&&e.start<n&&e.length>0&&(o=!0)),!!o||(t.push({text:"Ignoring invalid range: ",obj:e,level:a}),!1)})).sort((function(e,t){return e.start-t.start}));if(this.opt.wrapAllRanges)return o;var i,s=0;return o.filter((function(e){return e.start>=s?(s=e.start+e.length,!0):(i=e.start+e.length<s?"nesting":"overlapping",t.push({text:"Ignoring ".concat(i," range: "),obj:e,level:a}),!1)}))}},{key:"setType",value:function(e){var t=this.opt.blockElementsBoundary,n=Array.isArray(t.tagNames)&&t.tagNames.length;if(n&&t.tagNames.map((function(e){return e.toLowerCase()})).forEach((function(t){e[t]=2})),!n||t.extend)for(var r in e)e[r]=2;e.br=1}},{key:"getTextNodesAcross",value:function(e){var t=this;if(this.opt.cacheTextNodes&&this.cacheDict.nodes)return this.cacheDict.lastIndex=0,this.cacheDict.lastTextIndex=0,void e(this.cacheDict);var n,r,a,o,i={div:1,p:1,li:1,td:1,tr:1,th:1,ul:1,ol:1,br:1,dd:1,dl:1,dt:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,blockquote:1,figcaption:1,figure:1,pre:1,table:1,thead:1,tbody:1,tfoot:1,input:1,img:1,nav:1,details:1,label:1,form:1,select:1,menu:1,menuitem:1,main:1,section:1,article:1,aside:1,picture:1,output:1,button:1,header:1,footer:1,address:1,area:1,canvas:1,map:1,fieldset:1,textarea:1,track:1,video:1,audio:1,body:1,iframe:1,meter:1,object:1,svg:1},s=this.opt.blockElementsBoundary,c="";s&&(this.setType(i),s.char&&(c=s.char.charAt(0)));var u={nodes:[],text:"",tags:i,boundary:s,startOffset:0,str:c,str1:" "+c,str2:c+" ",str3:" "+c+" "};this.iterator.forEachNode(NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,(function(e){a?(a=e,t.getNodeInfo(r,e,o,u),r=e,o=null):r=a=e}),(function(e){return e.nodeType===Node.ELEMENT_NODE?(o?(n=i[e.nodeName.toLowerCase()])&&2===n&&(o=n):o=i[e.nodeName.toLowerCase()],NodeFilter.FILTER_REJECT):t.excludeElements(e.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}),(function(){a&&t.getNodeInfo(r,a,o,u);var n={text:u.text,nodes:u.nodes,lastIndex:0,lastTextIndex:0};t.opt.cacheTextNodes&&(t.cacheDict=n,t.cacheDict.type="across"),e(n)}))}},{key:"getNodeInfo",value:function(e,t,n,r){var a=0,o=r.text.length,i=e.textContent;if(e!==t){var s=/\s/.test(i[i.length-1]),c=/\s/.test(t.textContent[0]);if(r.boundary||!s&&!c){var u=n;if(!n)for(var l=e.parentNode;l;){if(n=r.tags[l.nodeName.toLowerCase()]){u=!(l===t.parentNode||l.contains(t));break}l=l.parentNode}if(u)if(s||c){if(2===n){var h=c&&s?r.str:c?r.str1:r.str2;r.text+=i+h,a=h.length}}else 1===n?(r.text+=i+" ",a=1):2===n&&(r.text+=i+r.str3,a=3)}}0===a&&(r.text+=i),r.nodes.push(this.createInfo(e,o,r.text.length-a,a,r.startOffset)),r.startOffset-=a}},{key:"createInfo",value:function(e,t,n,r,a){return{node:e,start:t,end:n,offset:r,startOffset:a}}},{key:"getTextNodes",value:function(e){var t=this;if(this.opt.cacheTextNodes&&this.cacheDict.nodes)e(this.cacheDict);else{var n="",r=[];this.iterator.forEachNode(NodeFilter.SHOW_TEXT,(function(e){r.push({start:n.length,end:(n+=e.textContent).length,offset:0,node:e})}),(function(e){return t.excludeElements(e.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}),(function(){var a={value:n,nodes:r,lastIndex:0,lastTextIndex:0};t.opt.cacheTextNodes&&(t.cacheDict=a,t.cacheDict.type="every"),e(a)}))}}},{key:"excludeElements",value:function(e){return-1!==["script","style","title","head","html"].indexOf(e.nodeName.toLowerCase())||this.opt.exclude&&this.opt.exclude.length&&c.matches(e,this.opt.exclude)}},{key:"wrapRangeInTextNode",value:function(e,t,n){var r=e.splitText(t),a=r.splitText(n-t);return this.createMarkElement(r),a}},{key:"createMarkElement",value:function(e){var t=this.opt.element?this.opt.element:"mark",n=document.createElement(t);return n.setAttribute("data-markjs","true"),this.opt.className&&n.setAttribute("class",this.opt.className),n.textContent=e.textContent,e.parentNode.replaceChild(n,e),n}},{key:"wrapRangeInTextNodeInsert",value:function(e,t,n,r,a,o){var i=r===t.node.textContent.length;if(0===n&&i){var s=this.createMarkElement(t.node);return t.node=s.childNodes[0],{retNode:t,markNode:s,increment:0}}var c=t.node.splitText(n),u=c.splitText(r-n),l=this.createMarkElement(c),h=1,f={start:a,end:t.start+r,offset:0,node:l.childNodes[0]},p={start:t.start+r,end:t.end,offset:t.offset,node:u};return 0===n?e.nodes.splice(o,1,f,p):(i?e.nodes.splice(o+1,0,f):(e.nodes.splice(o+1,0,f,p),h=2),t.end=a,t.offset=0),{retNode:p,markNode:l,increment:h}}},{key:"wrapRangeInMappedTextNode",value:function(e,t,n,r,a){var o=e.lastIndex,i=!0;if(this.opt.wrapAllRanges)for(;o>=0&&e.nodes[o].start>t;)o--;else if(t<e.lastTextIndex)return;for(;o<e.nodes.length;o++)if(o+1===e.nodes.length||e.nodes[o+1].start>t){var s=e.nodes[o];if(!r(s)){o>e.lastIndex&&(e.lastIndex=o);break}var c=t-s.start,u=(n>s.end?s.end:n)-s.start;if(c>=0&&u>c){if(this.opt.wrapAllRanges){var l=this.wrapRangeInTextNodeInsert(e,s,c,u,t,o);s=l.retNode,a(l.markNode,i)}else s.node=this.wrapRangeInTextNode(s.node,c,u),s.start+=u,e.lastTextIndex=s.start,a(s.node.previousSibling,i);i=!1}if(!(n>s.end)){e.lastIndex=o;break}t=s.end+s.offset}}},{key:"wrapGroups",value:function(e,t,n,r){return r((e=this.wrapRangeInTextNode(e,t,t+n)).previousSibling),e}},{key:"separateGroupsD",value:function(e,t,n,r,a){for(var o,i,s=0,c=0,u=0,l=!1,h=0;++u<t.length;)(o=t[u])&&(i=t.indices[u][0])>=s&&(h=t.indices[u][1],r(e,o,u)&&(e=this.wrapGroups(e,i-c,h-i,(function(e){a(e,u)})),h>s&&(s=h),c=h,l=!0));return l?n.regex.lastIndex=0:0===t[0].length&&this.setLastIndex(n.regex,h),e}},{key:"separateGroups",value:function(e,t,n,r,a){for(var o,i,s,c=t.index,u=-1,l=!1;++u<n.groups.length;)(i=t[o=n.groups[u]])&&-1!==(s=e.textContent.indexOf(i,c))&&(r(e,i,o)?(e=this.wrapGroups(e,s,i.length,(function(e){a(e,o)})),c=0,l=!0):c=s+i.length);return l&&(n.regex.lastIndex=0),e}},{key:"wrapMatchGroupsD",value:function(e,t,n,r,a){for(var o,i,s,c=0,u=0,l=0;++u<t.length;)(o=t[u])&&(i=t.indices[u][0],(this.opt.wrapAllRanges||i>=c)&&(l=t.indices[u][1],s=!1,this.wrapRangeInMappedTextNode(e,i,l,(function(e){return r(e.node,o,u)}),(function(e,t){s=!0,a(e,t,u)})),s&&l>c&&(c=l)));0===t[0].length&&this.setLastIndex(n.regex,l)}},{key:"setLastIndex",value:function(e,t){t>e.lastIndex?e.lastIndex=t:t>0?e.lastIndex++:e.lastIndex=1/0}},{key:"wrapMatchGroups",value:function(e,t,n,r,a){var o,i,s,c=0,u=0,l=t.index,h=t[0];this.opt.wrapAllRanges&&this.wrapRangeInMappedTextNode(e,l,l+h.length,(function(e){return r(e.node,h,u)}),(function(e,t){a(e,t,u)}));for(var f=0;f<n.groups.length;f++)u=n.groups[f],(o=t[u])&&(s=(i=h.indexOf(o,c))+o.length,-1!==i&&(this.wrapRangeInMappedTextNode(e,l+i,l+s,(function(e){return r(e.node,o,u)}),(function(e,t){a(e,t,u)})),c=s))}},{key:"collectRegexGroupIndexes",value:function(e){for(var t=[],n=[],r=-1,a=1,o=0,i=!1,s=e.source,c=/^\(\?<(?![=!])|^\((?!\?)/;++r<s.length;)switch(s[r]){case"(":i||(c.test(s.substring(r))?(n.push(1),0===o&&t.push(a),o++,a++):n.push(0));break;case")":i||1!==n.pop()||o--;break;case"\\":r++;break;case"[":i=!0;break;case"]":i=!1}return t}},{key:"wrapSeparateGroups",value:function(e,t,n,r,a){var o,i,s,c,u=this,l=e.hasIndices?"separateGroupsD":"separateGroups",h={regex:e,groups:e.hasIndices?{}:this.collectRegexGroupIndexes(e)},f={abort:!1},p={execution:f},d=0;this.getTextNodes((function(t){t.nodes.every((function(t){for(o=t.node,p.offset=t.start;null!==(i=e.exec(o.textContent))&&(e.hasIndices||""!==i[0])&&(p.match=i,s=c=!0,o=u[l](o,i,h,(function(e,t,r){return p.matchStart=s,p.groupIndex=r,s=!1,n(e,t,p)}),(function(e,t){c&&d++,r(e,{match:i,matchStart:c,count:d,groupIndex:t}),c=!1})),!f.abort););return!f.abort})),a(d)}))}},{key:"wrapMatches",value:function(e,t,n,r,a){var o,i,s,c=this,u=0===t?0:t+1,l={abort:!1},h={execution:l},f=0;this.getTextNodes((function(t){for(var p=0;p<t.nodes.length;p++){for(o=t.nodes[p],i=o.node;null!==(s=e.exec(i.textContent))&&""!==s[u];)if(h.match=s,h.offset=o.start,n(i,s[u],h)){var d=s[u].length,g=s.index;if(0!==u)for(var m=1;m<u;m++)g+=s[m].length;if(c.opt.cacheTextNodes){var v=c.wrapRangeInTextNodeInsert(t,o,g,g+d,o.start+g,p);if(f++,r(v.markNode,{match:s,count:f}),0===v.increment){e.lastIndex=0;break}p+=v.increment,o=v.retNode,i=o.node}else i=c.wrapGroups(i,g,d,(function(e){f++,r(e,{match:s,count:f})}));if(e.lastIndex=0,l.abort)break}if(l.abort)break}a(f)}))}},{key:"wrapGroupsAcrossElements",value:function(e,t,n,r,a){var o,i,s,c=this,u=e.hasIndices?"wrapMatchGroupsD":"wrapMatchGroups",l={regex:e,groups:e.hasIndices?{}:this.collectRegexGroupIndexes(e)},h={abort:!1},f={execution:h},p=0;this.getTextNodesAcross((function(t){for(;null!==(o=e.exec(t.text))&&(e.hasIndices||""!==o[0])&&(f.match=o,i=s=!0,c[u](t,o,l,(function(e,t,r){return f.matchStart=i,f.groupIndex=r,i=!1,n(e,t,f)}),(function(e,t,n){s&&p++,r(e,{match:o,matchStart:s,count:p,groupIndex:n,groupStart:t}),s=!1})),!h.abort););a(p)}))}},{key:"wrapMatchesAcross",value:function(e,t,n,r,a){var o,i,s=this,c=0===t?0:t+1,u={abort:!1},l={execution:u},h=0;this.getTextNodesAcross((function(t){for(;null!==(o=e.exec(t.text))&&""!==o[c];){l.match=o,i=!0;var f=o.index;if(0!==c)for(var p=1;p<c;p++)f+=o[p].length;var d=f+o[c].length;if(s.wrapRangeInMappedTextNode(t,f,d,(function(e){return l.matchStart=i,l.offset=e.startOffset,i=!1,n(e.node,o[c],l)}),(function(e,t){t&&h++,r(e,{match:o,matchStart:t,count:h})})),u.abort)break}a(h)}))}},{key:"wrapRanges",value:function(e,t,n,r){var a=this,o=[],i=[],s="warn",c=0;this.getTextNodes((function(u){var l=u.value.length,h=a.checkRanges(e,o,l);h.forEach((function(e,r){var h=e.start+e.length;h>l&&(o.push({text:"Range length was limited to: ".concat(h-l),obj:e,skip:!0,level:s}),h=l);var f=u.value.substring(e.start,h);f.trim()?a.wrapRangeInMappedTextNode(u,e.start,h,(function(n){return t(n.node,e,f,r)}),(function(t,r){r&&c++,n(t,e,{matchStart:r,count:c})})):(o.push({text:"Skipping whitespace only range: ",obj:e,level:s}),i.push(e))})),a.log("Valid ranges: ".concat(JSON.stringify(h.filter((function(e){return-1===i.indexOf(e)}))))),r(c,o)}))}},{key:"unwrapMatches",value:function(e){var t=e.parentNode,n=e.firstChild;if(1===e.childNodes.length)if(3===n.nodeType){var r=e.previousSibling,a=e.nextSibling;if(r&&3===r.nodeType)a&&3===a.nodeType?(r.nodeValue+=n.nodeValue+a.nodeValue,t.removeChild(a)):r.nodeValue+=n.nodeValue;else{if(!a||3!==a.nodeType)return void t.replaceChild(e.firstChild,e);a.nodeValue=n.nodeValue+a.nodeValue}t.removeChild(e)}else t.replaceChild(e.firstChild,e);else{if(n){for(var o=document.createDocumentFragment();e.firstChild;)o.appendChild(e.removeChild(e.firstChild));t.replaceChild(o,e)}else t.removeChild(e);t.normalize()}}},{key:"markRegExp",value:function(e,t){var n=this;this.opt=this.checkOption(t);var r=0,a=this.opt.separateGroups?"wrapSeparateGroups":"wrapMatches";if(this.opt.acrossElements&&(a=this.opt.separateGroups?"wrapGroupsAcrossElements":"wrapMatchesAcross"),this.opt.acrossElements&&!e.global&&!e.sticky){var o=e.toString().split("/");e=new RegExp(e.source,"g"+o[o.length-1]),this.log("RegExp was recompiled because it must have g flag")}this.log('Searching with expression "'.concat(e,'"')),this[a](e,this.opt.ignoreGroups,(function(e,t,a){return n.opt.filter(e,t,r,a)}),(function(e,t){r++,n.opt.each(e,t)}),(function(t){0===t&&n.opt.noMatch(e),n.opt.done(r,t)}))}},{key:"mark",value:function(e,t){var n=this;if(t&&t.combinePatterns)this.markCombinePatterns(e,t);else{this.opt=this.checkOption(t);var r=0,a=0,o=0,i=0,s=new u(this.opt),c=this.opt.acrossElements?"wrapMatchesAcross":"wrapMatches",l={},h=this.getSeparatedKeywords(e);0===h.length?this.opt.done(0,0,l):function e(t){var u=s.create(t),f=0;n.log('Searching with expression "'.concat(u,'"')),n[c](u,1,(function(e,r,a){return o=i+f,n.opt.filter(e,t,o,f,a)}),(function(e,t){f=t.count,a++,n.opt.each(e,t)}),(function(o){i+=o,0===o&&n.opt.noMatch(t),l[t]=o,++r<h.length?e(h[r]):n.opt.done(a,i,l)}))}(h[r])}}},{key:"markCombinePatterns",value:function(e,t){var n=this;this.opt=this.checkOption(t);var r,a,o=0,i=0,s=0,c=[],u=[],l=this.opt.acrossElements,h=l?"wrapMatchesAcross":"wrapMatches",f="gm".concat(this.opt.caseSensitive?"":"i"),p={},d=this.getSeparatedKeywords(e);if(0===d.length)this.opt.done(0,0,p);else{d.forEach((function(e){p[e]=0}));var g=this.getPatterns(d);u=g.termsParts,function e(t){var d=new RegExp(t,f),g=u[o];n.log('Searching with expression "'.concat(d,'"')),n[h](d,1,(function(e,t,o){return l?o.matchStart&&(r=n.getCurrentTerm(o.match,g)):r=n.getCurrentTerm(o.match,g),a=p[r],n.opt.filter(e,r,s+a,a,o)}),(function(e,t){i++,l?t.matchStart&&(p[r]+=1):p[r]+=1,n.opt.each(e,t)}),(function(t){s+=t;var r=g.filter((function(e){return 0===p[e]}));r.length&&n.opt.noMatch(r),++o<c.length?e(c[o]):n.opt.done(i,s,p)}))}((c=g.patterns)[o])}}},{key:"getCurrentTerm",value:function(e,t){for(var n=e.length;--n>2;)if(e[n])return t[n-3];return" "}},{key:"getPatterns",value:function(e){var t=new u(this.opt),n=t.create(e[0],!0),r=[],a=[],o=10;"number"==typeof this.opt.combinePatterns&&(this.opt.combinePatterns===1/0?o=Math.pow(2,31):this.isNumeric(this.opt.combinePatterns)&&(o=parseInt(this.opt.combinePatterns)));for(var i=Math.ceil(e.length/o),s=0;s<i;s++){for(var c=n.lookbehind+"(",l=[],h=Math.min(s*o+o,e.length),f=s*o;f<h;f++)l.push(e[f]);c+=t.createCombinePattern(l,!0).pattern,r.push(c+")"+n.lookahead),a.push(l)}return{patterns:r,termsParts:a}}},{key:"markRanges",value:function(e,t){var n=this;if(this.opt=t,this.cacheDict={},this.isArrayOfObjects(e)){var r=0;this.wrapRanges(e,(function(e,t,r,a){return n.opt.filter(e,t,r,a)}),(function(e,t,a){r++,n.opt.each(e,t,a)}),(function(e,t){n.report(t),n.opt.done(r,e)}))}else this.report([{text:"markRanges() accept an array of objects: ",obj:e,level:"error"}]),this.opt.done(0,0)}},{key:"unmark",value:function(e){var t=this;this.opt=e,this.cacheDict={};var n=(this.opt.element?this.opt.element:"mark")+"[data-markjs]";this.opt.className&&(n+=".".concat(this.opt.className)),this.log('Removal selector "'.concat(n,'"')),this.iterator.forEachNode(NodeFilter.SHOW_ELEMENT,(function(e){t.unwrapMatches(e)}),(function(e){return c.matches(e,n)&&!t.excludeElements(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),this.opt.done)}}]),e}();return n.default.fn.mark=function(e,t){return new l(this.get()).mark(e,t),this},n.default.fn.markRegExp=function(e,t){return new l(this.get()).markRegExp(e,t),this},n.default.fn.markRanges=function(e,t){return new l(this.get()).markRanges(e,t),this},n.default.fn.unmark=function(e){return new l(this.get()).unmark(e),this},n.default.fn.getVersion=function(){return new l(this.get()).version},n.default}));
