/*!***************************************************
* advanced-mark.js v2.0.0
* https://github.com/angezid/advanced-mark#readme
* MIT licensed
* Copyright (c) 2022–2023, angezid
* Original author Julian Kühnel, license https://git.io/vwTVl
*****************************************************/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).Mark=e(t.jQuery)}(this,(function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=e(t);function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(a=r.key,o=void 0,"symbol"==typeof(o=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(a,"string"))?o:String(o)),r)}var a,o}function o(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(){return i=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},i.apply(this,arguments)}var s=function(){function t(e,n){r(this,t),this.ctx=e,this.opt=n,this.attrName="data-markjsListener"}return o(t,[{key:"getContexts",value:function(){var t,e=!1;this.ctx?NodeList.prototype.isPrototypeOf(this.ctx)?t=this.ctx:Array.isArray(this.ctx)?(t=this.ctx,e=!0):t="string"==typeof this.ctx?document.querySelectorAll(this.ctx):[this.ctx]:t=[];var n=[];return t.forEach((function(t){-1!==n.indexOf(t)||n.some((function(e){return e.contains(t)}))||n.push(t)})),e&&n.sort((function(t,e){return(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING)>0?-1:1})),n}},{key:"getIframeContents",value:function(t,e,n){try{var r=t.contentWindow.document;r&&(t.setAttribute(this.attrName,"completed"),e({iframe:t,context:r}))}catch(e){t.setAttribute(this.attrName,"error"),n({iframe:t,error:e})}}},{key:"isIframeBlank",value:function(t){var e="about:blank",n=t.getAttribute("src").trim();return t.contentWindow.location.href===e&&n!==e&&n}},{key:"observeIframeLoad",value:function(t,e,n){var r=this;if(!t.hasAttribute(this.attrName)){var a=null,o=function o(){clearTimeout(a),t.removeEventListener("load",o),r.getIframeContents(t,e,n)};t.addEventListener("load",o),t.setAttribute(this.attrName,!0),a=setTimeout(o,this.opt.iframesTimeout)}}},{key:"onIframeReady",value:function(t,e,n){try{"complete"===t.contentWindow.document.readyState?this.isIframeBlank(t)?this.observeIframeLoad(t,e,n):this.getIframeContents(t,e,n):this.observeIframeLoad(t,e,n)}catch(t){n(t)}}},{key:"waitForAllIframes",value:function(e,n){var r=this,a=0,o=[],i=[],s=!1,c=setTimeout((function(){s=!0,n()}),this.opt.iframesTimeout),u=function(){clearTimeout(c),s||n()},l=function(){a===o.filter((function(t){return!r.hasAttributeValue(t,r.attrName,"error")})).length&&u()};!function e(n){n.iframe&&"about:blank"===n.context.location.href||(i=[],n.context.querySelectorAll(n.iframe?"body iframe":"iframe").forEach((function(e){t.matches(e,r.opt.exclude)||(o.push(e),e.hasAttribute(r.attrName)||i.push(e))})),n.iframe||i.length)?i.length?i.forEach((function(t){r.onIframeReady(t,(function(t){a++,e(t)}),(function(t){r.opt.debug&&console.log(t.error),l()}))})):l():u()}({context:e})}},{key:"createIterator",value:function(t,e,n){return document.createNodeIterator(t,e,n,!1)}},{key:"addRemoveStyle",value:function(t,e,n){if(n){if(!e||!t.firstChild||t.querySelector("style[data-markjs]"))return;t.insertBefore(e,t.firstChild)}else{var r=t.querySelector("style[data-markjs]");r&&t.removeChild(r)}}},{key:"createStyleElement",value:function(){var t=document.createElement("style");return t.setAttribute("data-markjs","true"),t.textContent=this.opt.shadowDOM.style,t}},{key:"hasAttributeValue",value:function(t,e,n){return t.hasAttribute(e)&&t.getAttribute(e)===n}},{key:"iterateThroughNodes",value:function(e,n,r,a,o){var i=this,s=this.opt.shadowDOM,c=this.opt.iframes;if(c||s){var u=0!=(n&NodeFilter.SHOW_ELEMENT),l=0!=(n&NodeFilter.SHOW_TEXT),h=s&&s.style?this.createStyleElement():null;l&&(n=NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);!function e(o){for(var f=i.createIterator(o,n);o=f.nextNode();)1===o.nodeType?(u&&r(o)&&a(o),c&&"iframe"===o.nodeName.toLowerCase()&&!t.matches(o,i.opt.exclude)&&i.hasAttributeValue(o,i.attrName,"completed")&&i.getIframeContents(o,(function(t){e(t.context)}),(function(){})),s&&o.shadowRoot&&"open"===o.shadowRoot.mode&&(i.addRemoveStyle(o.shadowRoot,h,l),e(o.shadowRoot))):l&&3===o.nodeType&&r(o)&&a(o)}(e)}else for(var f,d=this.createIterator(e,n,(function(t){return r(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}));f=d.nextNode();)a(f);o()}},{key:"forEachNode",value:function(t,e,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},o=this.getContexts(),i=o.length;i||a(),o.forEach((function(o){i--;var s=function(){r.iterateThroughNodes(o,t,n,e,(function(){i<=0&&a()}))};r.opt.iframes?r.waitForAllIframes(o,s):s()}))}}],[{key:"matches",value:function(t,e){if(!e||!e.length)return!1;var n="string"==typeof e?[e]:e,r=t.matches||t.matchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector;return r&&n.some((function(e){return!0===r.call(t,e)}))}}]),t}(),c=function(){function t(e){r(this,t),this.opt=i({},{diacritics:!0,synonyms:{},accuracy:"partially",caseSensitive:!1,ignoreJoiners:!1,ignorePunctuation:[],wildcards:"disabled"},e)}return o(t,[{key:"create",value:function(t,e){t=this.checkWildcardsEscape(t),Object.keys(this.opt.synonyms).length&&(t=this.createSynonyms(t));var n=this.getJoinersPunctuation();n&&(t=this.setupIgnoreJoiners(t)),this.opt.diacritics&&(t=this.createDiacritics(t)),t=t.replace(/\s+/g,"[\\s]+"),n&&(t=this.createJoiners(t,n)),"disabled"!==this.opt.wildcards&&(t=this.createWildcards(t));var r=this.createAccuracy(t);return e?r:new RegExp("".concat(r.lookbehind,"(").concat(r.pattern,")").concat(r.lookahead),"g".concat(this.opt.caseSensitive?"":"i"))}},{key:"createCombinePattern",value:function(t,e){var n=this;if(!Array.isArray(t)||!t.length)return null;var r=e?"(":"(?:",a=this.create(t[0],!0),o=a.lookbehind,i=a.lookahead;return{lookbehind:o,pattern:this.distinct(t.map((function(t){return"".concat(r).concat(n.create(t,!0).pattern,")")}))).join("|"),lookahead:i}}},{key:"sortByLength",value:function(t){return t.sort((function(t,e){return t.length===e.length?t>e?1:-1:e.length-t.length}))}},{key:"escape",value:function(t){return t.replace(/[[\]/{}()*+?.\\^$|]/g,"\\$&")}},{key:"escapeCharSet",value:function(t){return t.replace(/[-^\]\\]/g,"\\$&")}},{key:"toArrayIfString",value:function(t){return t&&t.length?this.distinct("string"==typeof t?t.split(""):t):[]}},{key:"distinct",value:function(t){var e=[];return t.forEach((function(t){t.trim()&&-1===e.indexOf(t)&&e.push(t)})),e}},{key:"createSynonyms",value:function(t){var e=this,n=this.opt.synonyms,r="g"+(this.opt.caseSensitive?"":"i");for(var a in n)if(n.hasOwnProperty(a)){var o=Array.isArray(n[a])?n[a]:[n[a]];if(o.unshift(a),(o=this.sortByLength(this.distinct(o)).map((function(t){return e.checkWildcardsEscape(t)}))).length>1){var i=o.map((function(t){return e.escape(t)})).join("|");t=t.replace(new RegExp(i,r),"(?:".concat(o.join("|"),")"))}}return t}},{key:"checkWildcardsEscape",value:function(t){return"disabled"!==this.opt.wildcards&&(t=t.replace(/(\\)*\?/g,(function(t,e){return e?"?":""})).replace(/(\\)*\*/g,(function(t,e){return e?"*":""}))),this.escape(t)}},{key:"createWildcards",value:function(t){var e="withSpaces"===this.opt.wildcards;return t.replace(/\u0001/g,e?"[\\S\\s]?":"\\S?").replace(/\u0002/g,e?"[\\S\\s]*?":"\\S*")}},{key:"setupIgnoreJoiners",value:function(t){return t.replace(/(\(\?:|\|)|\\?.(?=([|)]|$)|.)/g,(function(t,e,n){return e||void 0!==n?t:t+"\0"}))}},{key:"createJoiners",value:function(t,e){return t.split(/\u0000+/).join("[".concat(e,"]*"))}},{key:"getJoinersPunctuation",value:function(){var t=this.toArrayIfString(this.opt.ignorePunctuation),e="";return t.length&&(e=this.escapeCharSet(t.join(""))),this.opt.ignoreJoiners&&(e+="\\u00ad\\u200b\\u200c\\u200d"),e}},{key:"createDiacritics",value:function(t){var e=this.opt.caseSensitive,n=["aàáảãạăằắẳẵặâầấẩẫậäåāą","AÀÁẢÃẠĂẰẮẲẴẶÂẦẤẨẪẬÄÅĀĄ","cçćč","CÇĆČ","dđď","DĐĎ","eèéẻẽẹêềếểễệëěēę","EÈÉẺẼẸÊỀẾỂỄỆËĚĒĘ","iìíỉĩịîïī","IÌÍỈĨỊÎÏĪ","lł","LŁ","nñňń","NÑŇŃ","oòóỏõọôồốổỗộơởỡớờợöøō","OÒÓỎÕỌÔỒỐỔỖỘƠỞỠỚỜỢÖØŌ","rř","RŘ","sšśșş","SŠŚȘŞ","tťțţ","TŤȚŢ","uùúủũụưừứửữựûüůū","UÙÚỦŨỤƯỪỨỬỮỰÛÜŮŪ","yýỳỷỹỵÿ","YÝỲỶỸỴŸ","zžżź","ZŽŻŹ"];return t.split("").map((function(t){for(var r=0;r<n.length;r+=2)if(e){if(-1!==n[r].indexOf(t))return"["+n[r]+"]";if(-1!==n[r+1].indexOf(t))return"["+n[r+1]+"]"}else if(-1!==n[r].indexOf(t)||-1!==n[r+1].indexOf(t))return"["+n[r]+n[r+1]+"]";return t})).join("")}},{key:"createAccuracy",value:function(t){var e,n=this,r=this.opt.accuracy,a="()",o=t,i="";if("string"!=typeof r&&(e=(e=this.toArrayIfString(r.limiters)).length?e:null,r=r.value),"complementary"===r){var s="\\s"+(e?this.escapeCharSet(e.join("")):"!\"#$%&'()*+,\\-./:;<=>?@[\\]\\\\^_`{|}~¡¿");o="[^".concat(s,"]*").concat(t,"[^").concat(s,"]*")}else if("exactly"===r){var c=e?"|"+e.map((function(t){return n.escape(t)})).join("|"):"";a="(^|\\s".concat(c,")"),i="(?=$|\\s".concat(c,")")}return{lookbehind:a,pattern:o,lookahead:i}}}]),t}(),u=function(){function t(e){r(this,t),this.ctx=e,this.cacheDict={},this.empty=document.createTextNode(""),this.nodeNames=["script","style","title","head","html"]}return o(t,[{key:"opt",get:function(){return this._opt},set:function(t){this._opt=i({},{element:"",className:"",exclude:[],iframes:!1,iframesTimeout:5e3,separateWordSearch:!0,acrossElements:!1,ignoreGroups:0,each:function(){},noMatch:function(){},filter:function(){return!0},done:function(){},debug:!1,log:window.console},t)}},{key:"iterator",get:function(){return new s(this.ctx,this.opt)}},{key:"log",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"debug";if(this.opt.debug){var n=this.opt.log;this.isObject(n)&&"function"==typeof n[e]&&n[e]("mark.js: ".concat(t))}}},{key:"report",value:function(t){var e=this;t.forEach((function(t){e.log("".concat(t.text," ").concat(JSON.stringify(t.obj)),t.level?t.level:"debug"),t.skip||e.opt.noMatch(t.obj)}))}},{key:"checkOption",value:function(t){var e=!0,n=this.cacheDict.type;return n&&t&&t.cacheTextNodes&&(t.acrossElements?"across"===n&&(e=!1):"every"===n&&(e=!1)),e&&(this.cacheDict={}),t}},{key:"getSeachTerms",value:function(t){var e=this,n=this.isString(t)?[t]:t,r=[],a=function(t){t.trim()&&-1===r.indexOf(t)&&r.push(t)};return n.forEach((function(t){e.opt.separateWordSearch?t.split(" ").forEach((function(t){return a(t)})):a(t)})),r.sort((function(t,e){return e.length-t.length})),r}},{key:"isNumeric",value:function(t){return Number(parseFloat(t))==t}},{key:"isString",value:function(t){return"string"==typeof t}},{key:"isObject",value:function(t){return"[object Object]"===Object.prototype.toString.call(t)}},{key:"isArrayOfObjects",value:function(t){var e=this;return Array.isArray(t)&&t.some((function(t){return e.isObject(t)}))}},{key:"checkRanges",value:function(t,e,n){var r=this,a="error",o=t.filter((function(t){var o=!1;return r.isNumeric(t.start)&&r.isNumeric(t.length)&&(t.start=parseInt(t.start),t.length=parseInt(t.length),t.start>=0&&t.start<n&&t.length>0&&(o=!0)),!!o||(e.push({text:"Invalid range: ",obj:t,level:a}),!1)})).sort((function(t,e){return t.start-e.start}));if(this.opt.wrapAllRanges)return o;var i,s=0;return o.filter((function(t){return i=t.start+t.length,t.start>=s?(s=i,!0):(e.push({text:(i<s?"Nest":"Overlapp")+"ing range: ",obj:t,level:a}),!1)}))}},{key:"setType",value:function(t){var e=this.opt.blockElementsBoundary,n=Array.isArray(e.tagNames)&&e.tagNames.length;if(n&&e.tagNames.map((function(t){return t.toLowerCase()})).forEach((function(e){t[e]=2})),!n||e.extend)for(var r in t)t[r]=2;t.br=3}},{key:"getTextNodesAcross",value:function(t){var e=this;if(this.opt.cacheTextNodes&&this.cacheDict.nodes)return this.cacheDict.lastIndex=0,this.cacheDict.lastTextIndex=0,void t(this.cacheDict);var n,r,a,o,i={div:1,p:1,li:1,td:1,tr:1,th:1,ul:1,ol:1,dd:1,dl:1,dt:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,blockquote:1,figcaption:1,figure:1,pre:1,table:1,thead:1,tbody:1,tfoot:1,input:1,img:1,nav:1,details:1,label:1,form:1,select:1,menu:1,br:3,menuitem:1,main:1,section:1,article:1,aside:1,picture:1,output:1,button:1,header:1,footer:1,address:1,area:1,canvas:1,map:1,fieldset:1,textarea:1,track:1,video:1,audio:1,body:1,iframe:1,meter:1,object:1,svg:1},s=this.opt.blockElementsBoundary,c="";s&&(this.setType(i),s.char&&(c=s.char.charAt(0)));var u={nodes:[],text:"",regex:/\s/,tags:i,boundary:s,startOffset:0,str:c,str1:" "+c,str2:c+" ",str3:" "+c+" "};this.iterator.forEachNode(NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,(function(t){a?(a=t,e.getNodeInfo(r,t,o,u),r=t,o=null):r=a=t}),(function(t){return 1===t.nodeType?(o?s&&2!==o&&2===(n=i[t.nodeName.toLowerCase()])&&(o=n):o=i[t.nodeName.toLowerCase()],!1):!e.excludeElements(t.parentNode)}),(function(){a&&e.getNodeInfo(r,a,o,u);var n=e.createDict(u.text,u.nodes,"across");t(n)}))}},{key:"getNodeInfo",value:function(t,e,n,r){var a=0,o=t.textContent,i=r.text.length;if(t!==e)if(3===n)o+="\n",a=1;else{var s=r.regex.test(o[o.length-1]),c=r.regex.test(e.textContent[0]);if(r.boundary||!s&&!c){var u=n;if(!n)for(var l=t.parentNode;l;){if(n=r.tags[l.nodeName.toLowerCase()]){u=!(l===e.parentNode||l.contains(e));break}l=l.parentNode}if(u)if(s||c){if(2===n){var h=c&&s?r.str:c?r.str1:r.str2;o+=h,a=h.length}}else 1===n?(o+=" ",a=1):2===n&&(o+=r.str3,a=3)}}r.text+=o,r.nodes.push(this.createInfo(t,i,r.text.length-a,a,r.startOffset)),r.startOffset-=a}},{key:"getTextNodes",value:function(t){var e=this;if(this.opt.cacheTextNodes&&this.cacheDict.nodes)t(this.cacheDict);else{var n="",r=[];this.iterator.forEachNode(NodeFilter.SHOW_TEXT,(function(t){r.push({start:n.length,end:(n+=t.textContent).length,offset:0,node:t})}),(function(t){return!e.excludeElements(t.parentNode)}),(function(){var a=e.createDict(n,r,"every");t(a)}))}}},{key:"createDict",value:function(t,e,n){var r={text:t,nodes:e,lastIndex:0,lastTextIndex:0};return this.opt.cacheTextNodes&&(this.cacheDict=r,this.cacheDict.type=n),r}},{key:"excludeElements",value:function(t){return-1!==this.nodeNames.indexOf(t.nodeName.toLowerCase())||s.matches(t,this.opt.exclude)}},{key:"wrapRangeInsert",value:function(t,e,n,r,a,o){var i,s,c=r===e.node.textContent.length,u=0;if(0===n){if(c){var l=this.wrapTextNode(e.node);return e.node=l.childNodes[0],{markNode:l,nodeInfo:this.createInfo(this.empty,e.end,e.end,e.offset,0),increment:0}}i=e.node.splitText(r),s=e.node,u=1}else c?(s=e.node.splitText(n),i=this.empty,u=2):(i=(s=e.node.splitText(n)).splitText(r-n),u=3);var h=this.wrapTextNode(s),f=this.createInfo(h.childNodes[0],1===u?e.start:a,e.start+r,0,e.startOffset),d=this.createInfo(i,2===u?e.end:e.start+r,e.end,e.offset,e.startOffset);return 1===u?t.nodes.splice(o,1,f,d):(2===u?t.nodes.splice(o+1,0,f):t.nodes.splice(o+1,0,f,d),e.end=a,e.offset=0),{markNode:h,nodeInfo:d,increment:u<3?1:2}}},{key:"createInfo",value:function(t,e,n,r,a){return{node:t,start:e,end:n,offset:r,startOffset:a}}},{key:"wrapTextNode",value:function(t){var e=this.opt.element?this.opt.element:"mark",n=document.createElement(e);return n.setAttribute("data-markjs","true"),this.opt.className&&n.setAttribute("class",this.opt.className),n.textContent=t.textContent,t.parentNode.replaceChild(n,t),n}},{key:"wrapRange",value:function(t,e,n,r){var a,o=this.empty,i=n===t.textContent.length;return 0===e?(i||(o=t.splitText(n)),a=t):i?a=t.splitText(e):o=(a=t.splitText(e)).splitText(n-e),r(this.wrapTextNode(a)),o}},{key:"wrapRangeAcross",value:function(t,e,n,r,a){var o=t.lastIndex,i=!0,s=this.opt.wrapAllRanges||this.opt.cacheTextNodes;if(s)for(;o>=0&&t.nodes[o].start>e;)o--;else if(e<t.lastTextIndex)return;for(;o<t.nodes.length;o++)if(o+1===t.nodes.length||t.nodes[o+1].start>e){var c=t.nodes[o];if(!r(c)){o>t.lastIndex&&(t.lastIndex=o);break}var u=e-c.start,l=(n>c.end?c.end:n)-c.start;if(u>=0&&l>u){if(s){var h=this.wrapRangeInsert(t,c,u,l,e,o);c=h.nodeInfo,a(h.markNode,i)}else c.node=this.wrapRange(c.node,u,l,(function(t){a(t,i)})),c.start+=l,t.lastTextIndex=c.start;i=!1}if(!(n>c.end)){t.lastIndex=o;break}e=c.end+c.offset}}},{key:"wrapGroups",value:function(t,e,n,r,a){for(var o,i,s,c=e.index,u=-1,l=!1;++u<n.groups.length;)(i=e[o=n.groups[u]])&&-1!==(s=t.textContent.indexOf(i,c))&&(r(t,i,o)?(t=this.wrapRange(t,s,s+i.length,(function(t){a(t,o)})),c=0,l=!0):c=s+i.length);return l&&(n.regex.lastIndex=0),t}},{key:"wrapGroupsAcross",value:function(t,e,n,r,a){var o,i,s,c=0,u=0,l=e.index,h=e[0];this.opt.wrapAllRanges&&this.wrapRangeAcross(t,l,l+h.length,(function(t){return r(t,h,u)}),(function(t,e){a(t,e,u)}));for(var f=0;f<n.groups.length;f++)u=n.groups[f],(o=e[u])&&(s=(i=h.indexOf(o,c))+o.length,-1!==i&&(this.wrapRangeAcross(t,l+i,l+s,(function(t){return r(t,o,u)}),(function(t,e){a(t,e,u)})),c=s))}},{key:"wrapGroupsDFlag",value:function(t,e,n,r,a){for(var o,i,s=0,c=0,u=0,l=!1,h=0;++u<e.length;)(o=e[u])&&(i=e.indices[u][0])>=s&&(h=e.indices[u][1],r(t,o,u)&&(t=this.wrapRange(t,i-c,h-c,(function(t){a(t,u)})),h>s&&(s=h),c=h,l=!0));return l?n.regex.lastIndex=0:0===e[0].length&&this.setLastIndex(n.regex,h),t}},{key:"wrapGroupsDFlagAcross",value:function(t,e,n,r,a){for(var o,i,s,c=0,u=0,l=0;++u<e.length;)(o=e[u])&&(i=e.indices[u][0],(this.opt.wrapAllRanges||i>=c)&&(l=e.indices[u][1],s=!1,this.wrapRangeAcross(t,i,l,(function(t){return r(t,o,u)}),(function(t,e){s=!0,a(t,e,u)})),s&&l>c&&(c=l)));0===e[0].length&&this.setLastIndex(n.regex,l)}},{key:"setLastIndex",value:function(t,e){var n=t.lastIndex;t.lastIndex=e>n?e:e>0?n+1:1/0}},{key:"collectRegexGroupIndexes",value:function(t){for(var e=[],n=[],r=-1,a=1,o=0,i=!1,s=t.source,c=/^\(\?<(?![=!])|^\((?!\?)/;++r<s.length;)switch(s[r]){case"(":i||(c.test(s.substring(r))?(n.push(1),0===o&&e.push(a),o++,a++):n.push(0));break;case")":i||1!==n.pop()||o--;break;case"\\":r++;break;case"[":i=!0;break;case"]":i=!1}return e}},{key:"wrapSeparateGroups",value:function(t,e,n,r,a){var o,i,s,c,u=this,l=t.hasIndices,h=l?"wrapGroupsDFlag":"wrapGroups",f={regex:t,groups:l?{}:this.collectRegexGroupIndexes(t)},d={abort:!1},p={execution:d},g=0;this.getTextNodes((function(e){e.nodes.every((function(e){for(o=e.node,p.offset=e.start;null!==(i=t.exec(o.textContent))&&(l||""!==i[0])&&(p.match=i,s=c=!0,o=u[h](o,i,f,(function(t,e,r){return p.matchStart=s,p.groupIndex=r,s=!1,n(t,e,p)}),(function(t,e){c&&g++,r(t,{match:i,matchStart:c,count:g,groupIndex:e}),c=!1})),!d.abort););return!d.abort})),a(g)}))}},{key:"wrapSeparateGroupsAcross",value:function(t,e,n,r,a){var o,i,s,c=this,u=t.hasIndices,l=u?"wrapGroupsDFlagAcross":"wrapGroupsAcross",h={regex:t,groups:u?{}:this.collectRegexGroupIndexes(t)},f={abort:!1},d={execution:f},p=0;this.getTextNodesAcross((function(e){for(;null!==(o=t.exec(e.text))&&(u||""!==o[0])&&(d.match=o,i=s=!0,c[l](e,o,h,(function(t,e,r){return d.matchStart=i,d.groupIndex=r,d.offset=t.startOffset,i=!1,n(t.node,e,d)}),(function(t,e,n){s&&p++,r(t,{match:o,matchStart:s,count:p,groupIndex:n,groupStart:e}),s=!1})),!f.abort););a(p)}))}},{key:"wrapMatches",value:function(t,e,n,r,a){var o,i,s,c,u=this,l=0===e?0:e+1,h={abort:!1},f={execution:h},d={},p=0;this.getTextNodes((function(e){for(var g=0;g<e.nodes.length;g++){for(o=e.nodes[g],i=o.node;null!==(s=t.exec(i.textContent))&&""!==(c=s[l]);)if(f.match=s,f.offset=o.start,n(i,c,f)){for(var m=0,v=s.index;++m<l;)v+=s[m].length;var y=v+c.length;if(u.opt.cacheTextNodes){var x=u.wrapRangeInsert(e,o,v,y,o.start+v,g);if(d.match=s,d.count=++p,r(x.markNode,d),0===x.increment)break;g+=x.increment,o=x.nodeInfo,i=o.node}else i=u.wrapRange(i,v,y,(function(t){p++,r(t,{match:s,count:p})}));if(t.lastIndex=0,h.abort)break}if(h.abort)break}a(p)}))}},{key:"wrapMatchesAcross",value:function(t,e,n,r,a){var o,i,s,c=this,u=0===e?0:e+1,l={abort:!1},h={execution:l},f=0;this.getTextNodesAcross((function(e){for(;null!==(o=t.exec(e.text))&&""!==(i=o[u]);){h.match=o,s=!0;for(var d=0,p=o.index;++d<u;)p+=o[d].length;if(c.wrapRangeAcross(e,p,p+i.length,(function(t){return h.matchStart=s,h.offset=t.startOffset,s=!1,n(t.node,i,h)}),(function(t,e){e&&f++,r(t,{match:o,matchStart:e,count:f})})),l.abort)break}a(f)}))}},{key:"wrapRanges",value:function(t,e,n,r){var a=this,o=[],i=[],s="warn",c=0;this.getTextNodes((function(u){var l=u.text.length,h=a.checkRanges(t,o,l);h.forEach((function(t,r){var h=t.start+t.length;h>l&&(o.push({text:"Range was limited to: ".concat(l),obj:t,skip:!0,level:s}),h=l);var f=u.text.substring(t.start,h);f.trim()?a.wrapRangeAcross(u,t.start,h,(function(n){return e(n.node,t,f,r)}),(function(e,r){r&&c++,n(e,t,{matchStart:r,count:c})})):(o.push({text:"Skipping whitespace only range: ",obj:t,level:s}),i.push(t))})),a.log("Valid ranges: ".concat(JSON.stringify(h.filter((function(t){return-1===i.indexOf(t)}))))),r(c,o)}))}},{key:"unwrapMatches",value:function(t){var e=t.parentNode,n=t.firstChild;if(1===t.childNodes.length)if(3===n.nodeType){var r=t.previousSibling,a=t.nextSibling;if(r&&3===r.nodeType)a&&3===a.nodeType?(r.nodeValue+=n.nodeValue+a.nodeValue,e.removeChild(a)):r.nodeValue+=n.nodeValue;else{if(!a||3!==a.nodeType)return void e.replaceChild(t.firstChild,t);a.nodeValue=n.nodeValue+a.nodeValue}e.removeChild(t)}else e.replaceChild(t.firstChild,t);else{if(n){for(var o=document.createDocumentFragment();t.firstChild;)o.appendChild(t.removeChild(t.firstChild));e.replaceChild(o,t)}else e.removeChild(t);e.normalize()}}},{key:"markRegExp",value:function(t,e){var n=this;this.opt=this.checkOption(e);var r=0,a=0,o=this.opt.separateGroups?"wrapSeparateGroups":"wrapMatches";if(this.opt.acrossElements&&(o=this.opt.separateGroups?"wrapSeparateGroupsAcross":"wrapMatchesAcross",!t.global&&!t.sticky)){var i=t.toString().split("/");t=new RegExp(t.source,"g"+i[i.length-1]),this.log("RegExp is recompiled because it must have g flag")}this.log('Searching with expression "'.concat(t,'"')),this[o](t,this.opt.ignoreGroups,(function(t,e,r){return n.opt.filter(t,e,a,r)}),(function(t,e){a=e.count,r++,n.opt.each(t,e)}),(function(e){0===e&&n.opt.noMatch(t),n.opt.done(r,e)}))}},{key:"mark",value:function(t,e){var n=this;if(this.opt=this.checkOption(e),this.opt&&this.opt.combinePatterns)this.markCombinePatterns(t);else{var r=0,a=0,o=0,i=0,s=new c(this.opt),u=this.opt.acrossElements?"wrapMatchesAcross":"wrapMatches",l={},h=this.getSeachTerms(t);h.length?function t(e){var c=s.create(e),f=0;n.log('Searching with expression "'.concat(c,'"')),n[u](c,1,(function(t,r,a){return o=i+f,n.opt.filter(t,e,o,f,a)}),(function(t,e){f=e.count,a++,n.opt.each(t,e)}),(function(o){i+=o,0===o&&n.opt.noMatch(e),l[e]=o,++r<h.length?t(h[r]):n.opt.done(a,i,l)}))}(h[r]):this.opt.done(0,0,l)}}},{key:"markCombinePatterns",value:function(t){var e,n,r=this,a=0,o=0,i=0,s=[],c=[],u=this.opt.acrossElements,l=u?"wrapMatchesAcross":"wrapMatches",h="g".concat(this.opt.caseSensitive?"":"i"),f={},d=this.getSeachTerms(t);if(d.length){d.forEach((function(t){f[t]=0}));var p=this.getPatterns(d);c=p.termsParts,function t(d){var p=new RegExp(d,h),g=c[a];r.log('Searching with expression "'.concat(p,'"')),r[l](p,1,(function(t,a,o){return u?o.matchStart&&(e=r.getCurrentTerm(o.match,g)):e=r.getCurrentTerm(o.match,g),n=f[e],r.opt.filter(t,e,i+n,n,o)}),(function(t,n){o++,u?n.matchStart&&(f[e]+=1):f[e]+=1,r.opt.each(t,n)}),(function(e){i+=e;var n=g.filter((function(t){return 0===f[t]}));n.length&&r.opt.noMatch(n),++a<s.length?t(s[a]):r.opt.done(o,i,f)}))}((s=p.patterns)[a])}else this.opt.done(0,0,f)}},{key:"getCurrentTerm",value:function(t,e){for(var n=t.length;--n>2;)if(t[n])return e[n-3];return" "}},{key:"getPatterns",value:function(t){var e,n=new c(this.opt),r=n.create(t[0],!0),a=this.opt.combinePatterns,o=[],i=[],s=10;a===1/0?s=Math.pow(2,31):this.isNumeric(a)&&(e=parseInt(a))>0&&(s=e);for(var u=Math.ceil(t.length/s),l=0;l<u;l++){for(var h=r.lookbehind+"(",f=[],d=Math.min(l*s+s,t.length),p=l*s;p<d;p++)f.push(t[p]);h+=n.createCombinePattern(f,!0).pattern,o.push(h+")"+r.lookahead),i.push(f)}return{patterns:o,termsParts:i}}},{key:"markRanges",value:function(t,e){var n=this;if(this.opt=e,this.cacheDict={},this.isArrayOfObjects(t)){var r=0;this.wrapRanges(t,(function(t,e,r,a){return n.opt.filter(t,e,r,a)}),(function(t,e,a){r++,n.opt.each(t,e,a)}),(function(t,e){n.report(e),n.opt.done(r,t)}))}else this.report([{text:"markRanges() accept an array of objects: ",obj:t,level:"error"}]),this.opt.done(0,0)}},{key:"unmark",value:function(t){var e=this;this.opt=t,this.cacheDict={};var n=(this.opt.element?this.opt.element:"mark")+"[data-markjs]";this.opt.className&&(n+=".".concat(this.opt.className)),this.log('Removal selector "'.concat(n,'"')),this.iterator.forEachNode(NodeFilter.SHOW_ELEMENT,(function(t){e.unwrapMatches(t)}),(function(t){return s.matches(t,n)&&!e.excludeElements(t)}),this.opt.done)}}]),t}();return n.default.fn.mark=function(t,e){return new u(this.get()).mark(t,e),this},n.default.fn.markRegExp=function(t,e){return new u(this.get()).markRegExp(t,e),this},n.default.fn.markRanges=function(t,e){return new u(this.get()).markRanges(t,e),this},n.default.fn.unmark=function(t){return new u(this.get()).unmark(t),this},n.default.fn.getVersion=function(){return"2.0.0"},n.default}));
