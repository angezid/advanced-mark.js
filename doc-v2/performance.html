<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0" />
<title>Performance</title>
<link rel="icon" href="../static/img/favicon.ico">
<link href="../static/css/core.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="data/toc.js"></script>
<script src="../static/js/jquery.js"></script>
<script src="../static/js/core.js"></script>
<script src="../static/js/mark.js"></script>
</head>
<body>
<header>
<div id="menu"> </div>
<div class="logo"><a href=""></a></div>
<div class="search-form">
<form class="search" action="$search.html" method="get">
<input id="q" class="field" type="text" name="q" required placeholder="Search ..." />
<input class="submit" type="submit" />
</form>
</div>
<ul class="header-menu">
<li><a href="../index.html" id="home"> </a></li>
<li><a href="../playground/index.html" target="_blank">Playground</a></li>
<li><a class="selected" href="index.html">Doc</a></li>
</ul>
</header>

<div id="wrapper">
<div id="nav-wrap" class="nav-wrap">
<nav class="sidebar">
<div class="toc">
</div>
</nav>
</div>
<div id="content-wrap" class="content-wrap">
<form class="search-bar">
<div class="advanced-search"></div>
<div class="control-block">
<div class="highlight-all" data-label="All"></div>
<div class="whole-word" data-label="Whole"></div>
</div>
</form>
<main>
<article id="article"><h2 id="performance">Performance</h2>
<h3 id="the-performance-results-in-firefox-compare-to-mark.js-v8.11.1">The performance results in Firefox compare to mark.js v8.11.1:</h3>
<p><code>markRegExp()</code> method, <code>acrossElements : true</code>; marked words 3000</p>
<table>
<thead>
<tr>
<th>library</th>
<th>size 100KB</th>
<th>size 200KB</th>
<th>size 500KB</th>
<th>size 1MB</th>
</tr>
</thead>
<tbody>
<tr>
<td>mark.js</td>
<td>~350 ms.</td>
<td>~680 ms.</td>
<td>~1700 ms.</td>
<td>~2800 ms.</td>
</tr>
<tr>
<td>this</td>
<td>~30 ms.</td>
<td>~35 ms.</td>
<td>~45 ms.</td>
<td>~60 ms.</td>
</tr>
</tbody>
</table>
<p>the same without <code>acrossElements</code> option; marked words 3000</p>
<table>
<thead>
<tr>
<th>library</th>
<th>size 100KB</th>
<th>size 200KB</th>
<th>size 500KB</th>
<th>size 1MB</th>
</tr>
</thead>
<tbody>
<tr>
<td>mark.js</td>
<td>~30 ms.</td>
<td>~40 ms.</td>
<td>~70 ms.</td>
<td>~110 ms.</td>
</tr>
<tr>
<td>this</td>
<td>~30 ms.</td>
<td>~35 ms.</td>
<td>~40 ms.</td>
<td>~50 ms.</td>
</tr>
</tbody>
</table>
<p><code>markRanges()</code> method, marked ranges - 3000</p>
<table>
<thead>
<tr>
<th>library</th>
<th>size 100KB</th>
<th>size 200KB</th>
<th>size 500KB</th>
<th>size 1MB</th>
</tr>
</thead>
<tbody>
<tr>
<td>mark.js</td>
<td>~220 ms.</td>
<td>~350 ms.</td>
<td>~970 ms.</td>
<td>~1700 ms.</td>
</tr>
<tr>
<td>this</td>
<td>~36 ms.</td>
<td>~40 ms.</td>
<td>~51 ms.</td>
<td>~60 ms.</td>
</tr>
</tbody>
</table>
<p><code>unmark()</code> method, mark elements - 34500, size 1MB; mark time Firefox &amp; Chrome - ~360 ms</p>
<table>
<thead>
<tr>
<th>library</th>
<th>Firefox</th>
<th>Chrome</th>
</tr>
</thead>
<tbody>
<tr>
<td>mark.js</td>
<td>~1200 ms.</td>
<td>~1300 ms.</td>
</tr>
<tr>
<td>this</td>
<td>~210 ms.</td>
<td>~630 ms.</td>
</tr>
</tbody>
</table>
<h3 id="ways-to-boost-performance">Ways to boost performance</h3>
<p>Related highlighting a (especially) large array of strings or string with the <code>separateWordSearch</code> option.<br />
A <code>mark()</code> method highlights an array item by item, e.g. an array of 10 items is run 10 times. It isn't efficient.</p>
<p>There are two options to boost performance :</p>
<ul>
<li><p><code>combinePatterns</code> : combines given numbers of RegExp patterns into a single pattern, e.g. an array of 50 strings, <code>combinePatterns : 10</code> - creates 5 combine patterns, so instead of 50 runs there are only 5 runs. Any number bigger than the array length or <code>Infinity</code> creates a single combined pattern.
Note: with <code>diacritics</code> option, a single pattern can be monstrous and more slowly, it's better to create 5-7 patterns (it's probably related to a processor cache).<br />
Also, this option prevents highlighting inside already highlighted elements, but it only true for single combined pattern.</p>
</li>
<li><p><code>cacheTextNodes</code> : collecting text nodes information on every run is expensive. Caching this information improves performance with a large array.
The performance gain gradually grows, starting with an array containing 2-3 items and doubled with 4-5 items.<br />
  Note: this option does not change behavior as the <code>combinePatterns</code> option does. It can be used with existing code to improve performance.</p>
</li>
</ul>
<p>In Firefox marking an array of 500 words on a 1 MB page, 26500 text nodes, <code>diacritics : false</code> and ~7600 highlighted words :</p>
<ul>
<li>with <code>combinePatterns : Infinity</code> ~0.2 second. (single pattern)</li>
<li>with <code>cacheTextNodes</code> option ~4.2 sec.</li>
<li>with <code>cacheTextNodes</code> and <code>acrossElements</code> options ~1 sec.</li>
<li>with <code>acrossElements</code> options ~21 sec.</li>
<li>without above options ~19 sec.</li>
</ul>
<p>The same with <code>diacritics</code>:</p>
<ul>
<li>with <code>combinePatterns : Infinity</code> ~1.8 second. (single pattern)</li>
<li>with <code>combinePatterns : 100</code> ~0.4 second. (5 patterns)</li>
</ul>
<pre><code class="language-js">instance.mark([ <span class="str">'str1'</span>, <span class="str">'str2'</span>, .. ], {
  <span class="str">'combinePatterns'</span> : number  <span class="com">// or true (default number is 10)</span>
});</code></pre>

</article>
<footer><div class="info">
<p><a href="https://github.com/angezid/advanced-mark.js">advanced-mark.js</a> version 2</p>
</div></footer>
</main>
</div>
</div>
</body>
</html>
